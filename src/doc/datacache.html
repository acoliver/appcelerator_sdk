<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:app="http://www.appcelerator.org/appcelerator">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<script type="text/javascript" src="js/appcelerator.js"></script>

<link rel="stylesheet" type="text/css" href="css/appcelerator.css" />
<link rel="stylesheet" type="text/css" href="css/SyntaxHighlighter.css" />
<link rel="stylesheet" type="text/css" href="css/doc_content.css" />

<script type="text/javascript" src="js/seamless2.js"></script>
<script type="text/javascript" src="js/sh/shCore.js"></script>
<script type="text/javascript" src="js/sh/shBrushJScript.js"></script>
<script type="text/javascript" src="js/sh/shBrushXml.js"></script>
<script type="text/javascript" src="js/sh/shBrushCss.js"></script>
<script type="text/javascript" src="js/sh/shBrushRuby.js"></script>
<script type="text/javascript" src="js/sh/shBrushJava.js"></script>
<script type="text/javascript" src="js/sh/shBrushPhp.js"></script>



</head>
<body>
	<h2>Data Cache</h2>

	<!-- NAVIGATION -->
	<p>
	<a class="active" on="click then l:datacache[show=example] and add[class=active] or l:datacache[show!=example] then remove[class=active]">Example</a> |
	<a  on="click then l:datacache[show=code] and add[class=active] or l:datacache[show!=code] then remove[class=active]">Code</a> |
	<a  on="click then l:datacache[show=usage] and add[class=active] or l:datacache[show!=usage] then remove[class=active]">Usage</a> 
	</p>

	<!-- EXAMPLE -->
	<div on="l:datacache[show=example] then show else hide">
		<p>
			The Datacache Widget allows you to create a client-side cache for data.  This widget is very useful
			in cases where multiple components use the same message to get their data.  The result is 
			one service request instead of many.
		<p>
		<p>The Datacache Widget also allows you to automatically refresh the cache and to notify all of the 
			HTML elements that rely on that message for data - pretty cool.
		</p>
		<p>This demo takes 30 seconds so make sure you have plenty of rest before
			trying it.  In this demo, we have a Script Widget that increments a count every time
			the message <tt>l:get.data.request</tt> is received.  We have setup a Datacache Widget to 
			store this data and to auto-refresh (every 30 seconds).  Since we are using the Datacache
			Widget, the value is only incremented every 30 seconds.
		</p>

		<div style="border:1px solid #ccc;background-color:#f6f6f6;padding:10px;margin-top:10px;">
			<a on="click then l:get.data.request">Request Data</a>
			Current Cache Value (value should increment every ~30 seconds):
			<span on="l:get.data.response then value[result]"></span>
		</div>

		<p>Here's an example without the Dataache Widget.  It's the same example as above but
			without the cache.  Each time you click "Request Data" the count is incremented.
		</p>
		<div style="border:1px solid #ccc;background-color:#f6f6f6;padding:10px;margin-top:10px;">
			<a on="click then l:get.data.request2">Request Data</a>
			Current Value (value should increment on every click):
			<span  on="l:get.data.response2 then value[result]"></span>
		</div>

		<script>
		var count = 0;
		var count1 = 0;
		</script>

		<!-- datacache with auto-refresh -->
		<app:datacache request="l:get.data.request" keepAlive="30000" autoRefresh="true" 
		response="l:get.data.response">
		</app:datacache>

		<!-- script widget that increments count on every request
			this should only get executed every 30 seconds since
			the datacache widget is intercepting the requests
		 -->
		<app:script on="l:get.data.request then execute">
			count++;
			$MQ('l:get.data.response',{'result':count});
		</app:script>

		<!-- this message does not have a datacache defined for it 
			so it will get executed each time the request is made -->
		<app:script on="l:get.data.request2 then execute">
			count1++;
			$MQ('l:get.data.response2',{'result':count1});
		</app:script>
		
	</div>

	<!-- CODE -->
	<div on="l:datacache[show=code] then show else hide" style="display:none">
		<p>Here's the code:
			<textarea name="code" class="xml:nocontrols">

				<!-- datacache example -->
				<div style="border:1px solid #ccc;background-color:#f6f6f6;padding:10px;margin-top:10px;">
					<a on="click then l:get.data.request">Request Data</a>
					Current Cache Value (value should increment every ~30 seconds):
					<span on="l:get.data.response then value[result]"></span>
				</div>

				<!-- example without datacache -->
				<div style="border:1px solid #ccc;background-color:#f6f6f6;padding:10px;margin-top:10px;">
					<a on="click then l:get.data.request2">Request Data</a>
					Current Value (value should increment on every click):
					<span  on="l:get.data.response2 then value[result]"></span>
				</div>

				<!-- variables to increment for examples -->
				<script>
				var count = 0;
				var count1 = 0;
				</script>

				<!-- datacache with auto-refresh -->
				<app:datacache request="l:get.data.request" keepAlive="30000" autoRefresh="true" 
				response="l:get.data.response">
				</app:datacache>

				<!-- script widget that increments count on every request
					this should only get executed every 30 seconds since
					the datacache widget is intercepting the requests
				 -->
				<app:script on="l:get.data.request then execute">
					count++;
					$MQ('l:get.data.response',{'result':count});
				</app:script>

				<!-- this message does not have a datacache defined for it 
					so it will get executed each time the request is made -->
				<app:script on="l:get.data.request2 then execute">
					count1++;
					$MQ('l:get.data.response2',{'result':count1});
				</app:script>

			</textarea>	
		</p>
	</div>

	<!-- USAGE -->
	<div on="l:datacache[show=usage] then show else hide" style="display:none">
		<p>
			 Required Options:
				<table cellspacing="5px">
					<tr>
					  <td class="term">request</td>
					  <td class="def">Request message for cache</td>
					</tr>
					<tr>
					  <td class="term">response</td>
					  <td class="def">Response message for cache</td>
					</tr>
				</table>
		</p>
		<p>
			 Optional Options:
				<table cellspacing="5px">
					<tr>
					  <td class="term">keepAlive</td>
					  <td class="def">Time in milliseconds before cache data becomes stale. If
						<b>autoRefresh</b> is <b>false</b>, then the cache will be updated the
						next time the request message is generated by the application.  The default value is 30 seconds.</td>
					</tr>

					<tr>
					  <td class="term">autoRefresh</td>
					  <td class="def"><b>true</b> or <b>false</b>.  If <b>true</b>, the Datacache Widget
						will proactively re-fetch the data the moment it expires and it will send the response message so
						all HTML elements listening for that message will have their data refreshed
						automatically.</td>
					</tr>
				</table>
		</p>
	</div>	
	
	<script>
		dp.SyntaxHighlighter.ClipboardSwf = 'js/sh/clipboard.swf';

		dp.SyntaxHighlighter.HighlightAll('code');
	</script>

</body>

</html>