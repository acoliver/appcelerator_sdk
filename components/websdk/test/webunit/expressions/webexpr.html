<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:app="http://appcelerator.org">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<script type="text/javascript" src="../appcelerator/appcelerator-debug.js"></script>
	<link rel="stylesheet" type="text/css" href="../css/test.css" />
</head>
<body>

<h3> Web Expressions </h3> 
<p>
	These tests exercise web expressions parameter matching.
</p>

<table width="90%">
	<tr>
  		<td class="test">l:test[!foo]</td>
  		<td class="result" on="l:test[!foo] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[length!=0] (length is not present in payload)</td>
  		<td class="result" on="l:test[length!=0] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[id=wem1,countfoo=100] then value[failed] else value[passed] (multiple payloads with one missing)</td>
  		<td class="result">
  			<div on="l:test[id=wem1,countfoo=100] then value[failed] else value[passed]"></div>
  		</td>
  	</tr>
  	<tr>
  		<td class="test">l:test[count>0]</td>
  		<td class="result" on="l:test[count>0] then value[passed] else value[failed]"></td>
  	</tr> 
  	<tr>
  		<td class="test">l:test[count>1]</td>
  		<td class="result" on="l:test[count>1] then value[passed] else value[failed]"></td>
  	</tr> 
  	<tr>
  		<td class="test">l:test[count>99,count&lt;100,count=100]</td>
  		<td class="result" on="l:test[count>99,count<101,count=100] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[count<101]</td>
  		<td class="result" on="l:test[count<101] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[count&lt;=100]</td>
  		<td class="result" on="l:test[count<=100] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[count&gt;=100]</td>
  		<td class="result" on="l:test[count>=100] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[!count&gt;101]</td>
  		<td class="result" on="l:test[!count>101] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[!count&gt;=101]</td>
  		<td class="result" on="l:test[!count>=101] then value[passed] else value[failed]"></td>
  	</tr> 
  	<tr>
  		<td class="test">l:test[!count&lt;101]</td>
  		<td class="result" on="l:test[!count<101] then value[failed] else value[passed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[!count&lt;=200]</td>
  		<td class="result" on="l:test[!count<=200] then value[failed] else value[passed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[count!=200]</td>
  		<td class="result" on="l:test[count!=200] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[count=100]</td>
  		<td class="result" on="l:test[count=100] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[count=~100]</td>
  		<td class="result" on="l:test[count=~100] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[count=~1]</td>
  		<td class="result" on="l:test[count=~1] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[count=~^1]</td>
  		<td class="result" on="l:test[count=~^1] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[count=~0$]</td>
  		<td class="result" on="l:test[count=~0$] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[!count=~9$]</td>
  		<td class="result" on="l:test[!count=~9$] then value[passed] else value[failed]"></td>
  	</tr> 
  	<tr>
  		<td class="test">l:test[count]</td>
  		<td class="result" on="l:test[count] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[!foobar]</td>
  		<td class="result" on="l:test[!foobar] then value[passed] else value[failed]"></td>
  	</tr>
  	<tr>
  		<td class="test">l:test[count,!foobar]</td>
  		<td class="result" on="l:test[count,!foobar] then value[passed] else value[failed]"></td>
  	</tr>
   	<tr>
   		<td class="test">l:test[expr(this.count > 1)]</td>
   		<td class="result" on="l:test[expr(this.count > 1)] then value[passed] else value[failed]"></td>
   	</tr>
   	<tr>
   		<td class="test">l:test[expr(this.count > 1),count=100]</td>
   		<td class="result" on="l:test[expr(this.count > 1),count=100] then value[passed] else value[failed]"></td>
   	</tr>  
   	<tr>
   		<td class="test">l:test[expr(this.count > 1),count>99,expr(this.count==100)]</td>
   		<td class="result" on="l:test[expr(this.count > 1),count>99,expr(this.count==100)] then value[passed] else value[failed]"></td>
   	</tr>
   	<tr>
   		<td class="test">l:test then value[value=expr('[' + Appcelerator.Util.DateTime.get12HourTime() + '] ' + this.direction+':' + this.type + ' => ' + ' PASSED')]</td>
   		<td class="result" on="l:test then value[value=expr('[' + Appcelerator.Util.DateTime.get12HourTime() + '] ' + this.direction+':' + this.type + ' => ' + ' PASSED')]"></td>
   	</tr>
    	<tr>
   		<td class="test">l:test[count,expr(1+1>1)]</td>
   		<td class="result" on="l:test[count,expr(1+1>1)] then value[passed] else value[failed]"></td>
   	</tr>
   	<tr>
   		<td class="test">l:test[count=$foobar]</td>
   		<td class="result" on="l:test[count=$foobar] then value[passed] else value[failed]"></td>
   	</tr>
   	<tr>
   		<td class="test">l:test[$heyya]</td>
   		<td class="result" on="l:test[$heyya] then value[passed] else value[failed]"></td>
   	</tr> 
	<tr>
		<td class="test">l:test[$heyya2] (id reference doesn't exit)</td>
		<td class="result" on="l:test[$heyya2] then value[failed] else value[passed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[!$duh]</td>
		<td class="result" on="l:test[!$duh] then value[failed] else value[passed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[$duh]</td>
		<td class="result" on="l:test[$duh] then value[passed] else value[failed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[$duh=$duh]</td>
		<td class="result" on="l:test[$duh=$duh] then value[passed] else value[failed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[!$duhfailed]</td>
		<td class="result" on="l:test[!$duhfailed] then value[passed] else value[failed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[$duhfailed]</td>
		<td class="result" on="l:test[$duhfailed] then value[failed] else value[passed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[$duh=$duhfailed]</td>
		<td class="result" on="l:test[$duh=$duhfailed] then value[failed] else value[passed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[$duh!=$duhfailed]</td>
		<td class="result" on="l:test[$duh!=$duhfailed] then value[passed] else value[failed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[sub.p=passed]</td>
		<td class="result" on="l:test[sub.p=passed] then value[passed] else value[failed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[sub.p!=failed]</td>
		<td class="result" on="l:test[sub.p!=failed] then value[passed] else value[failed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[sub.i > 0]</td>
		<td class="result" on="l:test[sub.i > 0] then value[passed] else value[failed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[sub.b]</td>
		<td class="result" on="l:test[sub.b] then value[passed] else value[failed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[val=0]</td>
		<td class="result" on="l:test[val=0] then value[passed] else value[failed]"></td>
	</tr>
	<tr>
		<td class="test">l:test[src=src]</td>
		<td class="result">
			<iframe id="editor" src="../blank.html" on="l:test then set[src=src]" onloaded="l:test.frame.loaded"
				frameborder="0" style="margin:0;padding:0;height:20px;width:99%;overflow:hidden;">
			</iframe>
		</td>
	</tr>
	<tr>
		<td class="test">l:test[expr(Appcelerator.Browser.isSafari || Appcelerator.Browser.isFirefox || Appcelerator.Browser.isIE)]</td>
		<td class="result" on="l:test[expr(Appcelerator.Browser.isSafari || Appcelerator.Browser.isFirefox ||  Appcelerator.Browser.isIE)] then value[passed] else value[failed]"></td>
	</tr>
	<tr>
		<td class="test">l:test then value[expr(this.sub.p)]</td>
		<td class="result" on="l:test then value[expr(this.sub.p)]"></td>
	</tr>
	<tr>
		<td class="test">#test1 (WEM: simple macro)</td>
		<td class="result" on="#test1">failed</td>
	</tr>
	<tr>
		<td class="test">#test2 then #test3 (WEM: partial macro)</td>
		<td class="result" on="#test2 then #test3">failed</td>
	</tr>
	<tr>
		<td class="test">#test4 (WEM: substitution)</td>
		<td class="result" on="#test4" id="wem1">failed</td>
	</tr>
	<tr>
		<td class="test">#test5[count=99,pass_fail=passed] (WEM: substitution #2)</td>
		<td class="result" on="#test5[count=99,pass_fail=passed]">failed</td>
	</tr>
	<tr>
		<td class="test">(l:test6 or l:test6.1) then l:test6.result[msg='passed '] (compound conditions)</td>
		<td class="result" on="(l:test6 or l:test6.1) then l:test6.result[msg='passed ']">
			<div>
				You should see pass twice below after you click this button:
				<button on="click then l:test6 and l:test6.1">Click me</button>
			</div>
			<div on="l:test6.result then value[msg,append=true]"></div>
		</td>
	</tr>
	<tr>
		<td class="test">#test7 (WEM: compound conditions)</td>
		<td class="result" on="#test7">
			<div>
				You should see pass twice below after you click this button:
				<button on="click then l:test7 and l:test7.1">Click me</button>
			</div>
			<div on="l:test7.result then value[msg,append=true]"></div>
		</td>
	</tr>
	<tr>
		<td class="test">Compound condition with an or expression afterwards (should turn yellow on first click, red on second and back to green on third and say passed)</td>
		<td class="result">
			<div on="(click or l:test.button) then set[backgroundColor=yellow] and script[if(!window.ctR)window.ctR=0;window.ctR+=1;] or l:reset.button then set[backgroundColor=red] or l:test.button[expr(window.ctR>1)] then value[passed] and set[backgroundColor=green,color=white]" style="width:100px;background-color:red;border:2px solid blue;padding:10px;">
			 click me first
			</div>
			<button on="click then l:reset.button">click me second</button>
			<button on="click then l:test.button">click me third</button>
		</td>
	</tr>
	<tr>
		<td class="test">Widget short-hand web expression</td>
		<td class="result" id="wsr">failed</td>
	</tr>
	<tr>
		<td class="test">Boolean expressions</td>
		<td class="result">
			<div on="l:test8[auth=false] then set[background=green,color=white] and value['passed'] else set[background=red,color=white] and value['failed']">waiting...</div>
			<button on="click then l:test8[auth=false]">Run Test</button>
		</td>
	</tr>
 	<tr>
		<td class="test">Boolean expressions</td>
		<td class="result">
			<div on="l:test9[auth!=true] then set[background=green,color=white] and value['passed'] else set[background=red,color=white] and value['failed']">waiting...</div>
			<button on="click then l:test9[auth=false]">Run Test</button>
		</td>
	</tr>
	<tr>
		<td class="test">Boolean expressions</td>
		<td class="result">
			<div on="l:test10[auth='false'] then set[background=green,color=white] and value['passed'] else set[background=red,color=white] and value['failed']">waiting...</div>
			<button on="click then l:test10[auth=false]">Run Test</button>
		</td>
	</tr>
	<tr>
		<td class="test">Boolean expressions (type conversions in condition)</td>
		<td class="result">
			<div on="l:test11[auth!='true'] then set[background=green,color=white] and value['passed'] else set[background=red,color=white] and value['failed']">waiting...</div>
			<button on="click then l:test11[auth=false]">Run Test</button>
		</td>
	</tr>
	<tr>
		<td class="test">Boolean expressions (type conversions in event)</td>
		<td class="result">
			<div on="l:test12[auth!='true'] then set[background=green,color=white] and value['passed'] else set[background=red,color=white] and value['failed']">waiting...</div>
			<button on="click then l:test12[auth='false']">Run Test</button>
		</td>
	</tr> 
</table>

<input type="hidden" id="foobar" value="100"/>
<input type="hidden" id="heyya" value="true"/>
<input type="hidden" id="duh" value="true"/>
<input type="hidden" id="duhfalse" value="false"/>

<app:message name="l:test" args="{'src':'iframe.html',count:'100','bar':null,'id':'wem1', 'sub':{'p':'passed','b':true,'i':109}, 'val':0}"></app:message>
<app:script on="l:test">$('wsr').innerHTML='passed'</app:script>

<script>
 $WEM({
     'test1':"l:test then value[passed]",
     'test2':"l:test",
     'test3':"value[passed]",
	 'test4':"l:test[id=#{id}] then value[passed]",
	 'test5':"l:test[count>#{count}] then value['#{pass_fail}']",
	 'test7':"(l:test7 or l:test7.1) then l:test7.result[msg='passed ']"
 });
</script> 

</body>
</html>
