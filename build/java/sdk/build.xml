<?xml version="1.0"?>

<project name="Appcelerator Platform SDK for Java" default="create" basedir=".">

    <description>Appcelerator Platform SDK for Java</description>

    <property file="${user.home}/.ant.properties"/>
    <property file="build.properties"/>

	<property name="dist.dir" value="dist/server"/>
	<path id="classpath">
		<fileset dir="dist/lib" includes="*.jar"/>
	</path>
	
	<target name="clean" description="** Cleanup the temporary stage directory">
		<delete dir="stage"/>
	</target>
		
	<target name="banner">
		<echo>Appcelerator Platform SDK for Java</echo>
		<echo>Licensed under the GNU GPL version 2</echo>
		<echo>Please read LICENSE for more details on usage</echo>
	</target>
	
	<target name="prompt.deploy.dir" unless="deploy.dir">
		<echo>Deploy the Appcelerator Server</echo>
		<input defaultvalue="deploy.dir" message="Where would you like to deploy?" addproperty="deploy.dir" />
	</target>
	<target name="deploy_server" depends="banner" description="** Deploy the Appcelerator Server">
		<antcall target="prompt.deploy.dir"/>
		<available file="${deploy.dir}" type="dir" property="deploy.dir.exists" />
		<fail unless="deploy.dir.exists">Directory ${deploy.dir} doesn't exist.</fail>
		<copy todir="${deploy.dir}">
			<fileset dir="${dist.dir}" includes="*.war" />
		</copy>
	</target>
	<target name="undeploy_server" description="** Undeploy the Appcelerator Server">
		<available file="${deploy.dir}/appcelerator" type="dir" property="appcelerator.deploy.dir.exists"/>
		<available file="${deploy.dir}/appcelerator.war" type="file" property="appcelerator.deploy.war.exists"/>
		<antcall target="undeploy.war"/>
		<antcall target="undeploy.dir"/>
	</target>
	<target name="undeploy.dir" if="appcelerator.deploy.dir.exists">
		<delete dir="${deploy.dir}/appcelerator"/>
	</target>
	<target name="undeploy.war" if="appcelerator.deploy.war.exists">
		<delete file="${deploy.dir}/appcelerator.war"/>
	</target>
	
	<target name="create" depends="banner" description="** Create a new Appcelerator for Java project">
		<echo>Creating a new Appcelerator Java project.</echo>
		<echo message=""/>
		<input message="What would you like to name the project?" addproperty="app.name" />
		<input message="Where would you like to create?" addproperty="create.dir" defaultvalue="${user.home}${file.separator}${app.name}"/>
		<available file="${create.dir}" type="dir" property="create.dir.exists" />
		<fail if="create.dir.exists">Directory ${create.dir} already exists. Please delete it to continue...</fail>
		<mkdir dir="${create.dir}" />
		<mkdir dir="${create.dir}/lib/appcelerator" />
		<mkdir dir="${create.dir}/src/java" />
		<mkdir dir="${create.dir}/src/web" />
		<copy todir="${create.dir}" filtering="true">
			<fileset dir="dist" includes="*.*"/>
			<filterset>
				<filter token="APPNAME" value="${app.name}"/>
				<filter token="APPCELERTOR_DIR" value="${basedir}"/>
			</filterset>
		</copy>
		<copy todir="${create.dir}" filtering="false">
			<fileset dir="dist">
				<include name="**/*"/>
				<exclude name="build.*"/>
				<exclude name=".project"/>
				<exclude name=".classpath"/>
		    </fileset>
		</copy>
		<copy todir="${create.dir}/src/web" filtering="false">
			<fileset dir="dist/web">
				<include name="**/*"/>
		    </fileset>
		</copy>
	</target>
		
</project>
