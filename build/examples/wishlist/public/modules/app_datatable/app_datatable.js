Appcelerator.Module.Datatable={modulePath:null,setPath:function(A){this.modulePath=A},getName:function(){return"appcelerator datatable"},getDescription:function(){return"datatable widget"},getVersion:function(){return 1},getSpecVersion:function(){return 1},getAuthor:function(){return"Amro Mousa"},getModuleURL:function(){return"http://www.appcelerator.org"},isWidget:function(){return true},getWidgetName:function(){return"app:datatable"},createDataTable:function(id,pagination_direction){var on_array=[];var parameterMap=$(id).parameterMap;var scope=parameterMap["scope"];var wire=parameterMap["wire"];var sort=parameterMap["sort"];var rowEvenClass=parameterMap["rowEvenClass"];var rowOddClass=parameterMap["rowOddClass"];var width=parameterMap["width"];var add_spacers_to_header=parameterMap["add_spacers_to_header"];var header_array=parameterMap["header_array"];var array=parameterMap["array"];var pagination=parameterMap["pagination"];var maxRows=parseInt(parameterMap["maxRows"]);if(pagination=="true"&&!pagination_direction){pagination_direction="forward";maxRows=maxRows==0?10:maxRows}if(pagination=="false"){maxRows=maxRows==0?array.length:maxRows}parameterMap["maxRows"]=maxRows;var html="";var table_open='<table cellspacing="0" border="0" width="'+width+'">';var table_close="</table>";var table_header_content="";var table_data_content="";var arrow_up_img='<img src="'+Appcelerator.Module.Datatable.modulePath+'images/arrow_up.png" title="sort ascending" style="position:relative;top:-1px; left: 2px;" />';var arrow_down_img='<img src="'+Appcelerator.Module.Datatable.modulePath+'images/arrow_down.png" title="sort ascending" style="position:relative;top:-1px; left: 2px;" />';var spacer_img='<img src="'+Appcelerator.Module.Datatable.modulePath+'images/arrow_spacer.png" title="sort ascending" style="position:relative;top:-1px; left: 2px;" />';if(add_spacers_to_header){for(var i=0,len=header_array.length;i<len;i++){header_array[i]["cell"]=header_array[i]["cell"].replace(arrow_up_img,"");header_array[i]["cell"]=header_array[i]["cell"].replace(arrow_down_img,"");header_array[i]["cell"]=header_array[i]["cell"].replace(spacer_img,"");header_array[i]["cell"]+=spacer_img}}for(var x=0,len=header_array.length;x<len;x++){var header_info=header_array[x];var hclass=header_info["class"];if(hclass==""||hclass==null){hclass="table_cell_header"}var or="";if(header_info["on"]!=""){or=" or "}var sort_string="";if(sort=="client"){sort_string="click then script[Appcelerator.Module.Datatable.sortDataTableClient("+x+",'"+id+"')]"}else{if(sort=="server"){sort_string="click then script[Appcelerator.Module.Datatable.sortDataTableServer("+x+",'"+id+"')]";if(parameterMap["current_server_sort_column"]==header_info["property"]){if(!parameterMap["sortBy"][parameterMap["current_server_sort_column"]]){header_array[x]["cell"]=header_array[x]["cell"].replace(spacer_img,"");header_array[x]["cell"]+=arrow_up_img}else{header_array[x]["cell"]=header_array[x]["cell"].replace(spacer_img,"");header_array[x]["cell"]+=arrow_down_img}}}else{sort_string=""}}var hw=header_info["width"];var td='<td id="'+id+"_header_"+x+'" align="'+header_info["align"]+'" '+(hw?'width="'+hw+'"':"")+' class="'+hclass+'"><span>'+header_info["cell"]+"</span></td>";if(sort_string!=""){var header_on_expression=header_info["on"]+or+sort_string;on_array.push({"id":id+"_header_"+x,"on":header_on_expression})}table_header_content+=td}table_header_content='<tr class="table_row_header">'+table_header_content+"</tr>";var x=0;var length=maxRows;if(pagination=="true"){if(pagination_direction=="forward"){if($(id).initialLoad){x=$(id).position;$(id).initialLoad=false}else{x=$(id).position+maxRows>=array.length?$(id).position:$(id).position+maxRows}length=x+maxRows>array.length?array.length:x+maxRows}else{if($(id).position-maxRows<0){x=0;length=maxRows>array.length?array.length:maxRows}else{x=$(id).position-maxRows;length=x+maxRows>array.length?array.length:x+maxRows}}$(id).position=x}var xrun=x;for(;xrun<length;xrun++){table_data_content+='<tr class="table_row">';for(var h=0,lenH=header_array.length;h<lenH;h++){var cell_class=(xrun%2==0)?rowEvenClass:rowOddClass;if(cell_class==""){cell_class="table_cell"}var column_property_name=header_array[h]["property"];var cell_value=(array[xrun][column_property_name]||"");var td='<td align="'+header_array[h]["align"]+'" class="'+cell_class+'"><span>'+cell_value.toString().escapeHTML()+"</span></td>";table_data_content+=td}table_data_content+="</tr>"}html=table_open+table_header_content+table_data_content+table_close;var myidback=id+"_pagination_back";var myidforward=id+"_pagination_forward";if(pagination=="true"){var pag_html="";var myid="'"+id+"'";var forward='"forward"';var backward="'backward'";pag_html='<div style="padding-bottom: 5px;"><a class="pagination_links" id="'+myidback+'"><img style="border: 0;" src="'+Appcelerator.Module.Datatable.modulePath+'images/resultset_previous.png"/></a>&nbsp;<a class="pagination_links" id="'+myidforward+'"><img style="border: 0;" src="'+Appcelerator.Module.Datatable.modulePath+'images/resultset_next.png"/></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Showing '+(x+1)+"-"+(length)+" of "+array.length+"</div>";html=pag_html+html}Appcelerator.Compiler.setHTML(id,html);if(pagination=="true"){$(myidback).onclick=function(){Appcelerator.Module.Datatable.createDataTable(id,"backward")}.bind(this);$(myidforward).onclick=function(){Appcelerator.Module.Datatable.createDataTable(id,"forward")}.bind(this);$(myidback).onmousedown=function(){Appcelerator.Module.Datatable.paginateContinuously(id,"backward")}.bind(this);$(myidforward).onmousedown=function(){Appcelerator.Module.Datatable.paginateContinuously(id,"forward")}.bind(this);$(myidback).onmouseup=function(){Appcelerator.Module.Datatable.stopContinuousPagination(id)}.bind(this);$(myidforward).onmouseup=function(){Appcelerator.Module.Datatable.stopContinuousPagination(id)}.bind(this);$(myidback).onmouseout=function(){Appcelerator.Module.Datatable.stopContinuousPagination(id)}.bind(this);$(myidforward).onmouseout=function(){Appcelerator.Module.Datatable.stopContinuousPagination(id)}.bind(this)}var on_run_array=[];for(var i=0,len=on_array.length;i<len;i++){on_run_array.push(Appcelerator.Compiler.compileExpression($(on_array[i]["id"]),on_array[i]["on"],false))}eval(on_run_array.join(";"))},compileWidget:function(B,A){},paginateContinuously:function(C,A){var B=function(){if(A=="forward"){Appcelerator.Module.Datatable.createDataTable(C,"forward")}else{Appcelerator.Module.Datatable.createDataTable(C,"backward")}};$(C).paginationInterval=setInterval(B,250)},stopContinuousPagination:function(A){clearInterval($(A).paginationInterval)},sortDataTableClient:function(L,C){var A=$(C).parameterMap;var E=A["header_array"];var M=A["array"];var F=E[L]["property"];$(C).position=0;$(C).initialLoad=true;var H=true;for(var O=0,K=M.length;O<K;O++){var I=(M[O][F]||"");if(isNaN(parseFloat(I))){H=false}}if(A["sortBy"]==null){A["sortBy"]={};A["sortBy"][F]=false}A["sortBy"][F]=!A["sortBy"][F];if(H){var P=function B(S,R){var U=S[F];var T=R[F];return(A["sortBy"][F]==true)?parseFloat(U)-parseFloat(T):parseFloat(T)-parseFloat(U)};M.sort(P)}else{var J=function B(T,R){var U=T[F].toLowerCase();var S=R[F].toLowerCase();return(A["sortBy"][F]==true)?(S<U)-(U<S):(U<S)-(S<U)};M.sort(J)}var Q='<img src="'+Appcelerator.Module.Datatable.modulePath+'images/arrow_up.png" title="sort ascending" style="position:relative;top:-1px; left: 2px;" />';var D='<img src="'+Appcelerator.Module.Datatable.modulePath+'images/arrow_down.png" title="sort ascending" style="position:relative;top:-1px; left: 2px;" />';var N='<img src="'+Appcelerator.Module.Datatable.modulePath+'images/arrow_spacer.png" title="sort ascending" style="position:relative;top:-1px; left: 2px;" />';for(var G=0,K=E.length;G<K;G++){E[G]["cell"]=E[G]["cell"].replace(Q,"");E[G]["cell"]=E[G]["cell"].replace(D,"");E[G]["cell"]=E[G]["cell"].replace(N,"");E[G]["cell"]+=N}if(!A["sortBy"][F]){E[L]["cell"]=E[L]["cell"].replace(N,"");E[L]["cell"]+=Q}else{E[L]["cell"]=E[L]["cell"].replace(N,"");E[L]["cell"]+=D}A["add_spacers_to_header"]=false;Appcelerator.Module.Datatable.createDataTable(C)},sortDataTableServer:function(C,G){var A=$(G).parameterMap;var E=A["header_array"];var F=A["array"];var B=E[C]["property"];if(A["sortBy"]==null){A["sortBy"]={};A["sortBy"][B]=false}A["sortBy"][B]=!A["sortBy"][B];A["current_server_sort_column"]=B;var D="";if(A["sortBy"][B]){D="desc"}else{D="asc"}$MQ(A["sortRequest"],{"property":B,"direction":D},A["scope"])},execute:function(F,A,D,C){var B=A["property"];var E;$(F).position=0;$(F).initialLoad=true;if(B){E=Object.getNestedProperty(D,B)||[]}A["array"]=E;A["scope"]=C;$(F).parameterMap=A;Appcelerator.Module.Datatable.createDataTable(F)},getAttributes:function(){return[{name:"on",optional:true,description:"Used to populate the data table."},{name:"wire",optional:true,defaultValue:""},{name:"sort",optional:true,defaultValue:"client",description:"Valid values are 'client', 'server', and 'off.'"},{name:"sortRequest",optional:true,defaultValue:"",description:"Message to be sent when the sort mode is 'server' and a column header is clicked."},{name:"rowEvenClass",optional:true,defaultValue:""},{name:"rowOddClass",optional:true,defaultValue:""},{name:"width",optional:true,defaultValue:"100%",description:"Width % of entire table."},{name:"property",optional:true,defaultValue:""},{name:"pagination",optional:true,defaultValue:"false"},{name:"maxRows",optional:true,defaultValue:0}]},buildWidget:function(D,E){var B=document.createElement("div");B.innerHTML=D.innerHTML.replace(/<HEADER/gi,"<div").replace(/<\/HEADER/gi,"</div");var G=B.childNodes;var H=[];for(var C=0,A=G.length;C<A;C++){if(G[C].nodeName.toLowerCase()=="div"){var F={};header_langid=G[C].getAttribute("langid")||"";if(header_langid==""){F["cell"]=Appcelerator.Compiler.getHtml(G[C],true)}else{F["cell"]=Appcelerator.Localization.get(header_langid)}F["on"]=G[C].getAttribute("on")||"";F["class"]=G[C].className||"";F["property"]=G[C].getAttribute("property")||"";F["align"]=G[C].getAttribute("align")||"";H.push(F)}}E["header_array"]=H;E["add_spacers_to_header"]=true;return{"presentation":"","position":Appcelerator.Compiler.POSITION_REPLACE,"compile":true,"parameters":E,"functions":["execute"]}}};Appcelerator.Core.registerModule("app:datatable",Appcelerator.Module.Datatable);Appcelerator.Core.loadModuleCSS("app:datatable","datatable.css")