<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:app="http://www.appcelerator.org" xmlns:html="http://www.appcelerator.org">
<head>
<noscript><meta http-equiv="refresh" content="0;URL=upgrade_script.html"></noscript>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<title>WISHALISTA powered by Appcelerator&trade;</title>

<script type="text/javascript" src="js/appcelerator-debug.js"></script>
<link rel="stylesheet" type="text/css" href="css/items.css" />
</head>

<body style="display: none" on="l:app.compiled then show">
    <div class="item_list">
        <h2>My Wishalista</h2>
        <div style="display: false" class="error" on="r:~.*[success=false] then value[message] and show else hide"></div>
        
		<app:iterator on="r:wl.list.item.response[success=true] then execute" property="items">
            <html:div class="item_list" on="r:wl.remove.item.response[success=true,item_id=#{item_id}] then effect[Fade]">
				<html:div class="user_controls" showMyControls="#{isMe}">
					<html:div 
						class="remove"
						on='click then r:wl.remove.item.request[item_id=#{item_id}] 
						    if expr[confirm("Are you sure?")]'>
						<span>remove</span>
					</html:div>
	                <html:div 
						class="edit" 
						on='click then l:wl.expand.edit[item_id=#{item_id}]'>
						<span>edit</span>
					</html:div>
	            </html:div>
				<html:div class="other_user_controls" showMyControls="#{isMe}">
					<html:div 
						class="remove"
						on='click then r:wl.claim.item.request[item_id=#{item_id}]'>
						<span>claim</span>
					</html:div>
	                <html:div 
						class="edit" 
						on='click then r:wl.purchase.item.request[item_id=#{item_id}]'>
						<span>bought</span>
					</html:div>
	            </html:div>
				<html:h4 
					class="name" 
					on="click then l:wl.expand.description[item_id=#{item_id}]">
					#{name}
				</html:h4>
	        </html:div>
	        <html:div 
				class="description" 
				on="l:wl.expand.description[item_id=#{item_id}] then toggle[display]" 
				style="display: none">
				<html:p>#{note}</html:p>
			</html:div>
            <html:div style="display: none" class="edit_item" on="l:wl.expand.edit[item_id=#{item_id}] then toggle[display]">
                <html:input type="hidden" name="item_id" fieldset="#{item_id}" value="#{item_id}"></html:input>
                <html:input type="text" fieldset="#{item_id}" name="name" value="#{name}"></html:input>
                <html:textarea fieldset="#{item_id}" name="note">#{note}</html:textarea>
                <html:input type="text" fieldset="#{item_id}" name="occasion" value="#{occasion}"></html:input>
                <html:input type="button" value="Wish It!" fieldset="#{item_id}" on="click then r:wl.edit.item.request"></html:input>
            </html:div>
        </app:iterator>

    </div>
	<div on="r:wl.list.item.response[success=true,isMe=true] then show" style="display:none;">
		<div style="border: 1px solid #eee; cursor: pointer">
			<a on="click then l:show.add.item.form">Add Item</a>	
		</div>
		<div style="display:none;" on="l:show.add.item.form then show or r:wl.add.item.response[success=true] then hide">
	        <div class="edit_item">
				<form on="r:wl.add.item.response then reset" fieldset="additem">
		            <input type="text" fieldset="additem" name="name" value="Name"></input>
		            <textarea fieldset="additem" name="note">Description</textarea>
		            <input type="text" fieldset="additem" name="occasion" value="Occasion"></input>
		            <input type="button" value="Wish It!" fieldset="additem" on="click then r:wl.add.item.request"></input>
	        	</form>
			</div>
			<span on="r:wl.add.item.request then show or r:wl.add.item.response then hide" style="display:none;"><img src="images/indicator.gif" />&nbsp;Adding..</span>
		</div>
	</div>
	<div on="r:wl.add.item.response[success=true] then r:wl.list.item.request or r:wl.edit.item.request then r:wl.list.item.request"></div>

	<!-- Remove when this gets tied into a backend -->
    <app:message on="l:app.compiled then execute" name="r:wl.list.item.request" args="{user_id:1}"></app:message>
</body>
</html>