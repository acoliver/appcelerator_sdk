<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:app="http://www.appcelerator.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<script type="text/javascript" src="js/appcelerator.js"></script>
</head>
<body>
	<div class="forums_container" on="main[threads] then effect[appear] else hide" style="display:none;">
		<div on="r:threads.response[type=byforum] then show else hide" style="display:none">
			<a class="title pointer" on="click then r:forums.request">Forums</a>
			<h1 style="margin-top:0;" on="r:threads.response then value[forum.name]"></h1>
		</div>
		<div on="r:threads.response[type=byuser] then show else hide" style="display:none">
			<input type="hidden" id="threads_response_userid" on="r:threads.response[type=byuser] then value[user.id]"></input>
			<input type="hidden" id="threads_response_username" on="r:threads.response[type=byuser] then value[user.username]"></input>
			<a class="title pointer" on="click then r:users.request">Users</a>
			<!--<a on="click then r:user.request[userid=$threads_response_userid,username=threads_response_username] or r:threads.response[type=byuser] then value[user.username]" class="title"></a>-->
			<h1 style="margin-top:0;" on="r:threads.response then value[user.username]"></h1>
		</div>
		<div on="r:threads.response[type=search] then show else hide" style="display:none">
			<h1 style="margin-top:0;" id="threads_query_header"></h1>
		</div>
		<app:script on="r:threads.response[type=search] then execute">
			$('threads_query_header').innerHTML='results for query "'+ this.data.query+'"';
		</app:script>
		<p class="subtitle">
		<span on="r:threads.response then value[threads]"></span> thread(s), 
		<span on="r:threads.response then value[posts]"></span> post(s), <span on="r:threads.response then value[users]"></span> voice(s)
		</p>
		<div class="forums_header">
			<div class="forums_header_forums"><span>Threads</span></div>
			<div class="forums_header_lastpost"><span>Last Post</span></div>
		</div>
		<div class="forums_content" on="r:threads.response then effect[appear] or r:threads.request then hide" style="display:none;">
			<app:iterator on="r:threads.response then execute" property="rows">
				<html:table border="0" width="100%" cellspacing="0" cellpadding="0">
					<html:tr class="forum_content_row">	
						<html:td class="thread_icon"></html:td>
						<html:td class="forum_title">
							<html:a on="click then r:posts.request[threadid=#{id}]" class="title pointer">#{name}</html:a>
							<html:div class="stats">#{voices} voice(s), #{posts} post(s) in thread</html:div>
							<html:div class="description">#{lastpost.body}</html:div>
						</html:td>
						<html:td class="forums_postdate">
							#{lastpost.date} by <html:a on="click then r:user.request[userid=#{lastpost.user.id},username='#{lastpost.user.username}']" class="smalllink pointer">#{lastpost.user.username}</html:a>
						</html:td>
					</html:tr>
				</html:table>
			</app:iterator>
		</div>
		<!-- create a new forum -->
		<div on="login[in] then show else hide" style="display:none">
			<form on="enter then click[id=save_thread_button]">
			<div class="forums_container edittable" on="r:threads.response[type=byforum] then show else hide" style="display:none;">
				<table>
					<input type="hidden" fieldset="thread" id="newthread_forumid" on="r:threads.response[type=byforum] then value[forum.id]"></input>
					<tr>
						<td class="bold_value_grey">title:</td>
						<td><input type="text" fieldset="thread" id="newthread_name" validator="required" decorator="required"  on="r:createthread.response then clear"/></td>
					</tr>
					<tr>
						<td class="bold_value_grey">post body:</td>
						<td>
							<textarea fieldset="thread" id="newthread_body" on="r:createthread.response then clear"></textarea>
						</td>
					</tr>
					<tr>
						<td colspan="2" align="left" >
							<input type="button" value="create new thread" fieldset="thread" style="margin-top:10px" on="click then r:createthread.request[newthread_userid=expr(Forums.user.id)]"
								activators="newthread_name" id="save_thread_button"/>
						</td>
					</tr>
				</table>
			</div>
			</form>
		</div>
		<app:script on="r:threads.request then execute">
			Forums.lastthreadrequest=this.data;
		</app:script>
 		<app:script on="r:createthread.response then execute">
			$MQ('r:threads.request',Forums.lastthreadrequest);
		</app:script>
	</div>
</body>