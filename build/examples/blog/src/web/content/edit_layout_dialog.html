<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>Edit Dialog</title>  
</head>
<body>
    <app:script on="l:drop.item then execute">
        var dropped_element = this.data.dropped;
        $(this.data.id).appendChild(dropped_element);
        dropped_element.style.float = "none";
        dropped_element.style.position = "relative";
        dropped_element.style.left = "";
        dropped_element.style.top = "";
    </app:script>
    <app:modaldialog on="r:edit.layout.response then execute and script[$MQ('r:load.layout.dialog.request')]">         
        <html:div width="80%" class="modal_dialog">
            <html:div class="dialog_header">
                Edit #{layout_title} <span style='display: none' on="r:save.layout.response then show and effect[Fade]">(Saved)</span>
            </html:div>
            <html:div class="dialog_body">
                <html:table width="100%" height="30px">
                <html:tr>
                    <html:th>
                        Title:
                    </html:th>
                    <html:td class="clickable">
                        <app:editinplace type='text' id="layout_title" saveOn="click then l:save" 
                            cancelOn="click then l:cancel" validator="required" position="right"
                            defaultClassName="name" defaultValue="#{layout_title}">
                        </app:editinplace> 
                    </html:td>
                </html:tr>    
                </html:table>
                <html:h3 class="text_area">Layout</html:h3>
                <html:div class="text_area">
                    <html:div class="left_column">
                        <html:div class="layout_body">
                            <html:div class="layout_header" id="header_drop_area" droppable='true' on="drop then l:drop.item[dropped=dropped]">
                                <html:h5>header</html:h5>
                                <app:iterator on="r:load.layout.dialog.response then execute" property="header_snippets">
                                    <html:div class="name clickable" snippet_id="#{snippet_id}" draggable='true'>#{title}</html:div>
                                </app:iterator>
                            </html:div>                        
                            <html:div class="layout_content" id="content_drop_area" droppable='true' on="drop then l:drop.item[dropped=dropped]">
                                <html:h5>content</html:h5>
                                <app:iterator on="r:load.layout.dialog.response then execute" property="content_snippets">
                                    <html:div class="name clickable" snippet_id="#{snippet_id}" draggable='true'>#{title}</html:div>
                                </app:iterator>
                            </html:div>                        
                            <html:div class="layout_footer" id="footer_drop_area" droppable='true' on="drop then l:drop.item[dropped=dropped]">
                                <html:h5>footer</html:h5>
                                <app:iterator on="r:load.layout.dialog.response then execute" property="footer_snippets">
                                    <html:div class="name clickable" snippet_id="#{snippet_id}" draggable='true'>#{title}</html:div>
                                </app:iterator>
                            </html:div>                        
                            <html:div class="layout_sidebar" id="sidebar_drop_area" droppable='true' on="drop then l:drop.item[dropped=dropped]">
                                <html:h5>sidebar</html:h5>
                                <app:iterator on="r:load.layout.dialog.response then execute" property="sidebar_snippets">
                                    <html:div class="name clickable" snippet_id="#{snippet_id}" draggable='true'>#{title}</html:div>
                                </app:iterator>
                            </html:div>                        
                        </html:div>
                    </html:div>            
                    <html:div class="right_column">
                        <html:h4 class="snippet_list_header">Layout Elements</html:h4>
                        <html:div class="snippet_list" id="snippet_list_drop_area" droppable='true' on="drop then l:drop.item[dropped=dropped]">
                            <app:iterator on="r:load.layout.dialog.response then execute" property="snippets">
                                 <html:div class="name clickable" snippet_id="#{snippet_id}" draggable='true'>#{title}</html:div>
                            </app:iterator>
                        </html:div>
                    </html:div>
                    <html:div style="clear: both"></html:div>
                </html:div>
                <html:input type="button" on="click then l:appcelerator.modaldialog.hide" value="close"></html:input> 
                <html:input type="button" on="click then l:save.layout[layout_id=#{id}]" value="save"></html:input> 
                <html:input type="button" on="click then l:save.layout[layout_id=#{id},close=true]" value="Save and Close"></html:input>
            </html:div>
        </html:div>
    </app:modaldialog>
    <app:message on="r:save.layout.response[result=success,close=true] then execute" name="l:appcelerator.modaldialog.hide"></app:message>
    <app:script on="l:save.layout then execute">
        saveLayoutData(this.data);
    </app:script>
</body>
</html>
