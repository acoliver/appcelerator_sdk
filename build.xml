<?xml version="1.0"?>

<!-- ==================================================================== -->
<!-- Appcelerator Platform SDK                                            -->	
<!-- ==================================================================== -->

<project name="Appcelerator Platform SDK" default="dist" basedir=".">

    <description>Appcelerator Platform SDK</description>

    <property file="${user.home}/.ant.properties"/>
    <property file="build.properties"/>

	<path id="classpath">
		<fileset dir="${build.java.dir}/lib" includes="*.jar"/>
	</path>
	
	<path id="script.classpath">
		<fileset dir="${build.java.dir}/lib" includes="*.jar"/>
		<fileset dir="build/java/antlib" includes="jruby.jar,asm-2.2.3.jar,asm-commons-2.2.3.jar,bsf.jar,backport-util-concurrent.jar"/>
		<fileset dir="build/java/lib" includes="commons-logging-1.0.4.jar"/>
	</path>

	<target name="dist" depends="build_sdks"></target>
	
	<target name="clean" description="* Removes temporary build directories">
		<delete dir="${stage.dir}"/>
		<delete dir="${src.python.dir}/dist"/>
		<delete dir="${src.python.dir}/build"/>
		<delete>
			<fileset dir="${src.python.dir}/appcelerator/templates/hello_project/+package+/public" includes="**"/>
		</delete>
	</target>

	<target name="init">
		<mkdir dir="${stage.dir}"/>
		<tstamp/>
        <property name="APP_VERSION" value="${version.major}.${version.minor}.${version.rev}"/>
        <property name="APP_DATE" value="${DSTAMP} ${TSTAMP}"/>
        <property name="VERSION" value="${APP_VERSION}"/>		
	</target>

	<target name="build_core_javascript" depends="build_core_javascript_js,copy_web_files,jscompress,nojscompress" description="* Builds the core JS framework">
	</target>
	
	<target name="build_core_javascript_js" depends="init" description="* Builds the core JS framework">
		<delete file="${stage.dir}/web/js/appcelerator.js" failonerror="no"/>
		<delete file="${stage.dir}/web/js/appcelerator-temp.js" failonerror="no"/>
		<delete file="${stage.dir}/web/js/appcelerator-debug.js" failonerror="no"/>
		<concat destfile="${stage.dir}/web/js/appcelerator-debug.js" append="no">
			<fileset file="${build.dir}/license_header.txt"/>
		</concat>
		<concat destfile="${stage.dir}/web/js/appcelerator-debug.js" append="yes" fixlastline="yes">
/* The following files are subject to license agreements by their respective license owners */
		</concat>
		<concat destfile="${stage.dir}/web/js/appcelerator-debug.js" append="yes">
            <fileset file="${src.web.dir}/js/prolog.js"/>
			<fileset file="${build.web.dir}/prototype/prototype.js"/>
			<fileset file="${build.web.dir}/scriptaculous/scriptaculous.js"/>
			<fileset file="${build.web.dir}/scriptaculous/effects.js"/>
			<fileset file="${build.web.dir}/scriptaculous/dragdrop.js"/>
			<fileset file="${build.web.dir}/scriptaculous/resizable.js"/>
		</concat>
		<concat destfile="${stage.dir}/web/js/appcelerator-debug.js" append="yes" fixlastline="yes">
/* END THIRD PARTY SOURCE */
		</concat>
		<concat destfile="${stage.dir}/web/js/appcelerator-debug.js" append="yes">
			<fileset file="${src.web.dir}/js/bootstrap.js"/>
			<filterchain>
				<expandproperties/>
			</filterchain>
		</concat>
		<concat destfile="${stage.dir}/web/js/appcelerator-debug.js" append="yes">
			<fileset file="${src.web.dir}/js/core.js"/>
			<fileset file="${src.web.dir}/js/debug.js"/>
			<fileset file="${src.web.dir}/js/string.js"/>
			<fileset file="${src.web.dir}/js/object.js"/>
			<fileset file="${src.web.dir}/js/datetime.js"/>
			<fileset file="${src.web.dir}/js/config.js" />
			<fileset file="${src.web.dir}/js/compiler.js"/>
			<fileset file="${src.web.dir}/js/dom.js"/>
			<fileset file="${src.web.dir}/js/cookie.js"/>
			<fileset file="${src.web.dir}/js/servicebroker.js"/>
			<fileset dir="${src.web.dir}/js">
				<include name="**/*.js"/>
				<exclude name="bootstrap.js"/>
				<exclude name="core.js"/>
				<exclude name="compiler.js"/>
				<exclude name="dom.js"/>
				<exclude name="debug.js"/>
				<exclude name="string.js"/>
				<exclude name="cookie.js"/>
				<exclude name="config.js"/>
				<exclude name="datetime.js"/>
				<exclude name="object.js"/>
				<exclude name="servicebroker.js"/>
				<exclude name="prolog.js"/>
			</fileset>
		</concat>
	</target>
	<target name="nomin">
		<property name="dont.jscompress" value="anything"/>
	</target>
	<target name="min" unless="dont.jscompress">
		<property name="do.jscompress" value="anything"/>
	</target>
	<target name="jscompress" depends="copy_web_files" if="do.jscompress">
    	<exec executable="java" failonerror="true" failifexecutionfails="true">
    		<arg line="-jar ${build.bin.dir}/yuicompressor-2.2.5.jar"/>
    		<arg line="${stage.dir}/web/js/appcelerator-debug.js"/>
    		<arg line="-o ${stage.dir}/web/js/appcelerator-temp.js"/>
    	</exec>
    	<exec executable="ruby" failonerror="true" failifexecutionfails="true">
    		<arg line="${build.bin.dir}/compress.rb"/>
    		<arg line="${stage.dir}/web/js/appcelerator-temp.js"/>
    		<arg line="${stage.dir}/web/js/appcelerator-temp2.js"/>
    	</exec>
		<concat destfile="${stage.dir}/web/js/appcelerator.js" append="no">
			<fileset file="${build.dir}/license_header.txt"/>
    		<fileset file="${stage.dir}/web/js/appcelerator-temp2.js"/>
    	</concat>
		<delete file="${stage.dir}/web/js/appcelerator-temp.js"/>
		<delete file="${stage.dir}/web/js/appcelerator-temp2.js"/>
		<echo>Minimizing JS Modules</echo>
    	<exec executable="ruby" failonerror="true" failifexecutionfails="true">
    		<arg line="${build.bin.dir}/modules.rb"/>
    		<arg line="${stage.dir}/web/modules"/>
    		<arg line="${stage.dir}/web/modules"/>
    		<arg line="${build.bin.dir}/yuicompressor-2.2.5.jar"/>
    	</exec>
		<echo message="minimized"/>
	</target>
	<target name="nojscompress" unless="do.jscompress" depends="copy_web_files" >
		<concat destfile="${stage.dir}/web/js/appcelerator.js" append="no">
			<fileset file="${build.dir}/license_header.txt"/>
    		<fileset file="${stage.dir}/web/js/appcelerator-debug.js"/>
    	</concat>
		<echo message="didn't minimize"/>
	</target>
	<target name="copy_web_files">
		<copy todir="${stage.dir}/web" filtering="no">
			<fileset dir="${src.web.dir}" excludes="js/**"/>
		</copy>
	</target>
	
	<target name="java_compile" depends="init" description="* Compiles the Java code">
		<mkdir dir="${stage.dir}/java/classes"/>
		<copy todir="${stage.dir}/src-java" filtering="true">
			<fileset dir="${src.java.dir}">
				<include name="**/*.java"/>
			</fileset>
			<filterchain>
				<expandproperties/>
			</filterchain>
		</copy>
		<javac debug="true" srcdir="${stage.dir}/src-java" destdir="${stage.dir}/java/classes" classpathref="classpath" excludes="**/myappcelerator/*" includeAntRuntime="false"/>
		<jar destfile="${stage.dir}/java/appcelerator-${version.major}.${version.minor}.${version.rev}.jar">
			<fileset dir="${stage.dir}/java/classes">
				<include name="**/*"/>
			</fileset>
			<fileset dir="${src.java.dir}">
				<exclude name="**/*.java"/>
			</fileset>
		</jar>
	</target>
	
	<target name="test_compile" depends="java_compile">
		<path id="c">
			<path refid="classpath"/>
			<fileset dir="${stage.dir}/java/" includes="appcelerator-${version.major}.${version.minor}.${version.rev}.jar"/>
		</path>
		<taskdef name="appc" classname="org.appcelerator.compiler.ant.Compiler" classpathref="c" />
		<appc srcdir="${stage.dir}/web" destdir="test"/>
	</target>
	<target name="build_sdks" depends="sdk_python_dist,sdk_java_dist,sdk_dotnet_dist,sdk_php_dist,sdk_ruby_dist,build_src_dist"></target>
	<target name="build_web" depends="build_core_javascript,copy_web_files"/>
	<target name="build_java" depends="build_web,java_compile"/>
	<target name="build_server.nomin" depends="nomin,build_server"/>
	<target name="build_server.min" depends="min,build_server"/>
	<target name="build_server" depends="build_java" description="* Builds the Java Server">
		<mkdir dir="${stage.dir}/java/server/web"/>
		<copy todir="${stage.dir}/java/server/web">
			<fileset dir="${stage.dir}/web" includes="**/*"/>
		</copy>
		<copy todir="${stage.dir}/java/server/web" overwrite="true">
			<fileset dir="${build.java.dir}/server/web" includes="**/*"/>
			<fileset dir="${build.java.dir}/server" includes="appcelerator.xml"/>
		</copy>
		<mkdir dir="${stage.dir}/java/server/WEB-INF"/>
		<mkdir dir="${stage.dir}/java/server/WEB-INF/logs"/>
		<copy todir="${stage.dir}/java/server/WEB-INF">
			<fileset dir="${build.java.dir}/server/WEB-INF" includes="**/*" excludes="**/*web.xml"/>
		</copy>
		<war destfile="${stage.dir}/java/server/appcelerator.war" webxml="${build.java.dir}/server/WEB-INF/web.xml">
			<lib dir="${build.java.dir}/lib" includes="*.jar" excludes="servlet*.jar,js-*.jar,ant-*.jar"/>
			<lib dir="${stage.dir}/java" includes="appcelerator-${version.major}.${version.minor}.${version.rev}.jar"/>
			<fileset dir="${stage.dir}/java/server/web" includes="**/**"/>
			<fileset dir="${stage.dir}/java/server" includes="WEB-INF/**"/>
		</war>
	</target>
	<target name="server_dist.nomin" depends="nomin,server_dist"/>
	<target name="server_dist" depends="build_server" description="* Builds the Java SDK distribution">
		<zip destfile="${stage.dir}/appcelerator_server_${VERSION}.zip" comment="Appcelerator Platform SDK for Java">
			<zipfileset dir="stage/java/server" includes="appcelerator.war" prefix="appcelerator_server_${VERSION}/dist/server"/>
			<zipfileset dir="${build.java.dir}/server" includes="build.xml,README" prefix="appcelerator_server_${VERSION}"/>
			<zipfileset dir="stage" includes="doc/**" prefix="appcelerator_server_${VERSION}"/>
		</zip>
	</target>
	<target name="build_web_unit" depends="init,build_web" description="* Builds the web unit test suite">
		<mkdir dir="${stage.dir}/test/web"/>
		<copy todir="${stage.dir}/test/web">
			<fileset dir="${stage.dir}/web">
				<include name="**/*"/>
				<exclude name="*.html"/>
			</fileset>
			<fileset dir="${stage.dir}/web">
				<include name="blank.html"/>
			</fileset>
			<fileset dir="${src.test.web.dir}">
				<include name="**/*"/>
			</fileset>
		</copy>
		<war destfile="${stage.dir}/unittest.war" webxml="${build.java.dir}/unittest/WEB-INF/web.xml">
			<fileset dir="${stage.dir}/test/web" includes="**/**"/>
			<fileset dir="${build.java.dir}/unittest" includes="*.*"/>
		</war>
	</target>
	<target name="build_doc.nomin" depends="nomin,build_doc"/>
	<target name="build_doc.min" depends="min,build_doc"/>
	<target name="build_doc" depends="init,build_web,build_java" description="* Builds the documentation">
		<mkdir dir="${stage.dir}/doc"/>
		<loadfile property="appcelerator.xml" srcFile="build/java/sdk/dist/src/web/appcelerator.xml"/>
		<loadfile property="appcelerator-services.xml" srcFile="build/examples/simple/appcelerator-services.xml"/>
		<loadfile property="appcelerator-dotnet.xml" srcFile="build/dotnet/src/web/appcelerator.xml"/>
		<loadfile property="appcelerator-php.xml" srcFile="build/php/sdk/dist/src/web/appcelerator.xml"/>
		<loadfile property="appcelerator-python.xml" srcFile="build/python/appcelerator.xml"/>
		<loadfile property="appcelerator-perl.xml" srcFile="build/perl/appcelerator.xml"/>
		<loadfile property="TestService.cs" srcFile="build/dotnet/TestService.cs"/>
		<loadfile property="ContactManager.java" srcFile="build/examples/simple/src/java/ContactManager.java"/>
		<loadfile property="contact_manager_service.php" srcFile="build/examples/simple/src/php/services/contact_manager_service.php"/>
		<loadfile property="contact_manager_service.rb" srcFile="build/examples/simple/src/ruby/services/contact_manager_service.rb"/>
		<loadfile property="ContactManagerService.cs" srcFile="build/examples/simple/src/dotnet/ContactManagerService.cs"/>
		<loadfile property="contact_manager_service.py" srcFile="build/examples/simple/src/python/services/contact_manager_service.py"/>
		<loadfile property="ContactManagerService.pm" srcFile="build/examples/simple/src/perl/services/ContactManagerService.pm"/>
		<loadfile property="index.html" srcFile="build/examples/simple/src/web/index.html"/>
		<copy todir="${stage.dir}/doc" filtering="true" overwrite="true">
			<fileset dir="${stage.dir}/web" includes="**/*" excludes="images/**"/>
			<filterset>
				<filter token="ruby_appcelerator.xml" value="${ruby_appcelerator.xml}"/>
				<filter token="appcelerator.xml" value="${appcelerator.xml}"/>
				<filter token="appcelerator-services.xml" value="${appcelerator-services.xml}"/>
				<filter token="VERSION" value="${VERSION}"/> 
				<filter token="ContactManager.java" value="${ContactManager.java}"/>
				<filter token="contact_manager_service.php" value="${contact_manager_service.php}"/>
				<filter token="contact_manager_service.rb" value="${contact_manager_service.rb}"/>
				<filter token="contact_manager_service.py" value="${contact_manager_service.py}"/>
				<filter token="ContactManagerService.cs" value="${ContactManagerService.cs}"/>
				<filter token="ContactManagerService.pm" value="${ContactManagerService.pm}"/>
				<filter token="index.html" value="${index.html}"/>
				<filter token="TestService.cs" value="${TestService.cs}"/>
				<filter token="appcelerator-dotnet.xml" value="${appcelerator-dotnet.xml}"/>
				<filter token="appcelerator-php.xml" value="${appcelerator-php.xml}"/>
				<filter token="appcelerator-python.xml" value="${appcelerator-python.xml}"/>
				<filter token="appcelerator-perl.xml" value="${appcelerator-perl.xml}"/>
			</filterset>
		</copy>
        <copy todir="${stage.dir}/doc" filtering="true" overwrite="true">
            <fileset dir="${src.doc.dir}" includes="**/*" excludes="images/**"/>
            <filterset>
                <filter token="ruby_appcelerator.xml" value="${ruby_appcelerator.xml}"/>
                <filter token="appcelerator.xml" value="${appcelerator.xml}"/>
                <filter token="appcelerator-services.xml" value="${appcelerator-services.xml}"/>
                <filter token="VERSION" value="${VERSION}"/> 
				<filter token="ContactManager.java" value="${ContactManager.java}"/>
				<filter token="contact_manager_service.php" value="${contact_manager_service.php}"/>
				<filter token="contact_manager_service.rb" value="${contact_manager_service.rb}"/>
				<filter token="contact_manager_service.py" value="${contact_manager_service.py}"/>
				<filter token="ContactManagerService.cs" value="${ContactManagerService.cs}"/>
				<filter token="ContactManagerService.pm" value="${ContactManagerService.pm}"/>
				<filter token="index.html" value="${index.html}"/>
				<filter token="TestService.cs" value="${TestService.cs}"/>
				<filter token="appcelerator-dotnet.xml" value="${appcelerator-dotnet.xml}"/>
				<filter token="appcelerator-php.xml" value="${appcelerator-php.xml}"/>
				<filter token="appcelerator-python.xml" value="${appcelerator-python.xml}"/>
				<filter token="appcelerator-perl.xml" value="${appcelerator-perl.xml}"/>
            </filterset>
        </copy>
		<copy todir="${stage.dir}/doc" filtering="false" overwrite="true">
			<fileset dir="${stage.dir}/web" includes="images/**"/>
			<fileset dir="${src.doc.dir}" includes="images/**"/>
		</copy>
        <mkdir dir="${stage.dir}/doc/WEB-INF/logs"/>
		<war destfile="${stage.dir}/doc.war" webxml="${build.java.dir}/server/WEB-INF/web.xml">
            <lib dir="${build.java.dir}/lib" includes="*.jar" excludes="servlet*.jar,js-*.jar,ant-*.jar"/>
            <lib dir="${stage.dir}/java" includes="appcelerator-${version.major}.${version.minor}.${version.rev}.jar"/>
			<fileset dir="${stage.dir}/doc" includes="**/**" />
			<fileset dir="${build.java.dir}/doc" includes="*.*"/>
            <fileset dir="${build.java.dir}/server" includes="WEB-INF/**"/>
		</war>
	</target>
	<target name="force_examples">
		<property name="explicitlybuild.examples" value="true"/>
	</target>
	<target name="build_examples.nomin" depends="nomin,build_examples"/>
	<target name="build_examples" depends="build_java,build_server,build_web,build_doc,build_web_unit" description="* Builds the examples" if="explicitlybuild.examples">
		<antcall target="build_example">
			<param name="example" value="blog"/>
		</antcall>
		<antcall target="build_example">
			<param name="example" value="forums"/>
		</antcall>
		<antcall target="build_example">
			<param name="example" value="simple"/>
		</antcall>
	</target>
	<target name="build_example">
		<delete dir="${stage.dir}/examples/${example}" failonerror="false"/>
		<mkdir dir="${stage.dir}/examples/${example}"/>
		<mkdir dir="${stage.dir}/examples/${example}/server"/>
		<mkdir dir="${stage.dir}/examples/${example}/lib"/>
		<mkdir dir="${stage.dir}/examples/${example}/lib/appcelerator"/>
		<copy todir="${stage.dir}/examples/${example}/src/web">
			<fileset dir="${stage.dir}/web" includes="**"/>
		</copy>
		<copy tofile="${stage.dir}/examples/${example}/server/setupfiles" file="${stage.dir}/java/server/appcelerator.war"/>
		<copy todir="${stage.dir}/examples" filtering="true" overwrite="true">
			<fileset dir="build/examples" includes="${example}/**"/>
		</copy>
		<copy todir="${stage.dir}/examples/${example}/lib/appcelerator" filtering="false"> 
			<fileset dir="${build.java.dir}/lib" includes="**/*"/>
			<fileset dir="${stage.dir}/java" includes="appcelerator-${VERSION}.jar"/>
		</copy>
		
		<!-- simulate creating a new project and then extracting -->
		
	</target>
	
	
	<target name="build_java_sdk" depends="build_java,build_web_unit,build_doc,build_server,build_examples" description="* Builds the SDK for Java">
		<mkdir dir="${stage.dir}/sdk/java"/>
		<mkdir dir="${stage.dir}/sdk/java/dist/lib"/>
		<mkdir dir="${stage.dir}/sdk/java/dist/lib/appcelerator"/>
		<mkdir dir="${stage.dir}/sdk/java/dist/server"/>
		<mkdir dir="${stage.dir}/sdk/java/doc"/>
		<mkdir dir="${stage.dir}/sdk/java/test"/>
		<copy todir="${stage.dir}/sdk/java" filtering="true"> 
			<fileset dir="${build.java.dir}/sdk" includes="README,*.*,dist/*.*,dist/src/java/**"/>
			<fileset dir="." includes="LICENSE"/>
		</copy>
		<copy todir="${stage.dir}/sdk/java/dist/lib/appcelerator" filtering="false"> 
			<fileset dir="${build.java.dir}/lib" includes="**/*"/>
			<fileset dir="${stage.dir}/java" includes="appcelerator-${VERSION}.jar"/>
		</copy>
		<copy todir="${stage.dir}/sdk/java/dist" filtering="false"> 
			<fileset dir="${build.java.dir}" includes="antlib/**"/>
		</copy>
		<copy todir="${stage.dir}/sdk/java/dist/src/web" filtering="false"> 
			<fileset dir="${stage.dir}/web" includes="**/*"/>
		</copy>
		<copy todir="${stage.dir}/sdk/java/dist" filtering="false" overwrite="true"> 
			<fileset dir="${build.java.dir}/sdk/dist" includes="**" excludes=".classpath"/>
		</copy>
		<copy todir="${stage.dir}/sdk/java/dist" filtering="false" overwrite="true"> 
			<fileset dir="stage" includes="examples/**"/>
		</copy>
		<copy todir="${stage.dir}/sdk/java/dist" filtering="true"> 
			<fileset dir="${build.java.dir}/sdk/dist" includes=".classpath"/>
			<filterchain>
				<expandproperties/>
			</filterchain>
		</copy>
		<copy tofile="${stage.dir}/sdk/java/dist/server/setupfiles" file="${stage.dir}/java/server/appcelerator.war"/>
		<copy todir="${stage.dir}/sdk/java/doc" filtering="false"> 
			<fileset dir="${stage.dir}/doc" includes="**/*"/>
		</copy>
		<copy todir="${stage.dir}/sdk/java/test" filtering="false"> 
			<fileset dir="${stage.dir}/test/web" includes="**/*"/>
		</copy>
	</target>
	<target name="build_php_sdk" depends="build_web,build_web_unit,build_doc,build_examples" description="* Builds the SDK for PHP">
		<mkdir dir="${stage.dir}/sdk/php"/>
		<mkdir dir="${stage.dir}/sdk/php/doc"/>
		<mkdir dir="${stage.dir}/sdk/php/test"/>
		<copy todir="${stage.dir}/sdk/php" filtering="true"> 
			<fileset dir="${build.php.dir}/sdk" includes="README,*.*"/>
			<fileset dir="." includes="LICENSE"/>
		</copy>
		<copy todir="${stage.dir}/sdk/php/src" filtering="false"> 
			<fileset dir="${stage.dir}/web" includes="**/*"/>
		</copy>
		<copy todir="${stage.dir}/sdk/php/src" filtering="false"> 
			<fileset dir="${src.php.dir}" includes="**/*"/>
		</copy>
		<copy todir="${stage.dir}/sdk/php/src" filtering="false" overwrite="true"> 
			<fileset dir="${build.php.dir}/sdk/dist/src/php" includes="**"/>
			<fileset dir="${build.php.dir}/sdk/dist/src/web" includes="**"/>
		</copy>
		<!--
		<copy todir="${stage.dir}/sdk/php/doc" filtering="false"> 
			<fileset dir="${stage.dir}/doc" includes="**/*"/>
		</copy>
		<copy todir="${stage.dir}/sdk/php/test" filtering="false"> 
			<fileset dir="${stage.dir}/test/web" includes="**/*"/>
		</copy>
		<copy todir="${stage.dir}/sdk/php/examples" filtering="false"> 
			<fileset dir="${stage.dir}/examples" includes="**/*" excludes="**/setupfiles,blog/**,forums/**,**/*.jar" />
		</copy>
	-->
	</target>

	<target name="build_perl_sdk" depends="build_web,build_web_unit,build_doc,build_examples" description="* Builds the SDK for PHP">
		<mkdir dir="${stage.dir}/sdk/perl"/>
		<mkdir dir="${stage.dir}/sdk/perl/doc"/>
		<mkdir dir="${stage.dir}/sdk/perl/test"/>
		<copy todir="${stage.dir}/sdk/perl" filtering="true"> 
			<fileset dir="." includes="LICENSE"/>
		</copy>
		<copy todir="${stage.dir}/sdk/perl/src" filtering="false"> 
			<fileset dir="${stage.dir}/web" includes="**/*"/>
		</copy>
		<copy todir="${stage.dir}/sdk/perl/src" filtering="false"> 
			<fileset dir="${src.perl.dir}" includes="**/*"/>
		</copy>
		<copy todir="${stage.dir}/sdk/perl/src" filtering="false" overwrite="true"> 
			<fileset dir="${build.perl.dir}" includes="**"/>
		</copy>
	</target>
	
	<target name="sdk_java_dist" depends="min,build_java_sdk" description="* Builds the Java SDK distribution">
		<mkdir dir="stage"/>
		<zip destfile="${stage.dir}/appcelerator_sdk_java_${VERSION}.zip" comment="Appcelerator Platform SDK for Java">
			<zipfileset dir="stage/sdk/java" prefix="appcelerator_sdk_java_${VERSION}">
				<include name="**/*"/>
				<exclude name="stage/**"/>
				<exclude name="output/**"/>
				<exclude name=".server.id"/>
			</zipfileset>
		</zip>
	</target>
	
	<target name="sdk_php_dist" depends="min,build_php_sdk" description="* Builds the PHP SDK distribution">
		<mkdir dir="stage"/>
		<zip destfile="${stage.dir}/appcelerator_sdk_php_${VERSION}.zip" comment="Appcelerator Platform SDK for PHP">
			<zipfileset dir="stage/sdk/php" prefix="">
				<include name="**/*"/>
				<exclude name="stage/**"/>
				<exclude name="output/**"/>
				<exclude name=".server.id"/>
			</zipfileset>
		</zip>
	</target>

	<target name="sdk_perl_dist" depends="min,build_perl_sdk" description="* Builds the Perl SDK distribution">
		<mkdir dir="stage"/>
		<zip destfile="${stage.dir}/appcelerator_sdk_perl_${VERSION}.zip" comment="Appcelerator Platform SDK for Perl">
			<zipfileset dir="stage/sdk/perl" prefix="">
				<include name="**/*"/>
				<exclude name="stage/**"/>
				<exclude name="output/**"/>
				<exclude name=".server.id"/>
			</zipfileset>
		</zip>
	</target>

	<target name="sdk_ruby_dist" depends="min,build_web" description="* Builds the Ruby on Rails SDK distribution">
		<mkdir dir="${stage.dir}/ruby"/>
        <property name="ruby_gem_version" value="${APP_VERSION}"/>
        <copy todir="${stage.dir}/ruby" filtering="true">
            <fileset dir="${src.ruby.dir}/gem" includes="**/*"/>
            <filterchain>
                <expandproperties/>
            </filterchain>
        </copy>
        <copy todir="${stage.dir}/ruby">
			<fileset dir="stage" includes="examples/**"/>
		</copy>
        <copy todir="${stage.dir}/ruby/appcelerator/templates" filtering="false">
             <fileset dir="${stage.dir}/web" includes="js/appcelerator*.js"/>
             <fileset dir="${stage.dir}/web" includes="modules/**/**"/>
             <fileset dir="${src.web.dir}" includes="css/**,images/**,index.html,servicetester.html"/>
        	 <fileset dir="${build.ruby.dir}" includes="appcelerator.xml,dist/README"/>
             <fileset dir="${build.ruby.dir}/dist/src/web" includes="**/**"/>
        </copy>
		<move file="${stage.dir}/ruby/appcelerator/templates/js" tofile="${stage.dir}/ruby/appcelerator/templates/javascripts"/>
		<move file="${stage.dir}/ruby/appcelerator/templates/css" tofile="${stage.dir}/ruby/appcelerator/templates/stylesheets"/>		
		<replaceregexp match="src=&quot;js" replace="src=&quot;javascripts" flags="g" byline="true">
		    <fileset dir="${stage.dir}/ruby/appcelerator/templates" includes="**/*.html"/>
		</replaceregexp>
        <replaceregexp match="0.0.0" replace="${APP_VERSION}" flags="g" byline="true">
            <fileset dir="${stage.dir}/ruby/lib" includes="appcelerator.rb"/>
        </replaceregexp>
        <exec dir="${stage.dir}/ruby" executable="rake">
            <arg line="update_manifest"/>
        </exec>
        <antcall target="gem"/>
	</target>
	<target name="gem" depends="init">
		<exec dir="${stage.dir}/ruby" executable="rake">
			<arg line="clean gem"/>
		</exec>
		<copy todir="${stage.dir}">
			<fileset dir="${stage.dir}/ruby/pkg" includes="*.gem"/>
		</copy>
	</target>
	<target name="sdk_dotnet_dist" depends="min,build_web,build_doc,build_web_unit" description="* Builds the .NET SDK distribution">
		<mkdir dir="stage"/>
		<copy todir="${stage.dir}/sdk/dotnet/src/web" filtering="false"> 
			<fileset dir="${stage.dir}/web" includes="**/*"/>
			<fileset dir="src/dotnet" includes="web.config"/>
		</copy>
		<copy todir="stage/sdk/dotnet" overwrite="true">
			<fileset dir="src/dotnet/bin/Release" includes="Appcelerator.dll"/>
			<fileset dir="build/dotnet" includes="**/**"/>
			<fileset dir="stage" includes="doc/**"/>
			<fileset dir="src/dotnet" includes="*-config.xml"/>
		</copy>
		<copy tofile="stage/sdk/dotnet/Appcelerator-debug.dll" file="src/dotnet/bin/Debug/Appcelerator.dll"/>
		<zip destfile="${stage.dir}/appcelerator_sdk_dotnet_${VERSION}.zip" comment="Appcelerator Platform SDK for .NET">
			<zipfileset dir="stage/sdk/dotnet">
				<include name="**/*"/>
				<exclude name="stage/**"/>
				<exclude name="output/**"/>
				<exclude name=".server.id"/>
			</zipfileset>
		</zip>
	</target>
	<target name="sdk_all_dist" depends="min,sdk_ruby_dist,sdk_java_dist,sdk_php_dist,sdk_python_dist,sdk_perl_dist,sdk_dotnet_dist" description="* Builds the distributions for all the platforms"/>
	<target name="install_all" depends="install_java,install_ruby,install_php,install_python,install_dotnet"/>
	<target name="install_java" depends="sdk_java_dist">
		<delete dir="${stage.dir}/appcelerator_sdk_java_${VERSION}" failonerror="false"/>
		<unzip src="${stage.dir}/appcelerator_sdk_java_${VERSION}.zip" dest="${stage.dir}"/>

		<delete dir="${basedir}/${stage.dir}/sdkprojects/myjavaapp" failonerror="false"/>
		<ant dir="${stage.dir}/appcelerator_sdk_java_${VERSION}" target="create.silent">
			<property name="app.name" value="myapp"/>
			<property name="create.dir" value="${basedir}/${stage.dir}/sdkprojects/myjavaapp"/>
		</ant>
		<ant dir="${basedir}/${stage.dir}/sdkprojects/myjavaapp" target="dist"/>
		<ant dir="${basedir}/${stage.dir}/sdkprojects/myjavaapp" target="undeploy"/>
		<ant dir="${basedir}/${stage.dir}/sdkprojects/myjavaapp" target="deploy"/>
	</target>
	<target name="install_forums" depends="force_examples,init,install_java_sdk">
		<antcall target="install_java_example">
			<param name="example" value="forums"/>
			<param name="plat.excludes" value="doc/**,examples/**,src/web/modules/**,test/**"/>
		</antcall>
	</target>
	<target name="install_java_sdk">
		<available file="${stage.dir}/appcelerator_sdk_java_${VERSION}" type="dir" property="sdk.java.exists"/>
		<antcall target="do.sdk"/>
	</target>
	<target name="do.sdk" unless="sdk.java.exists">
		<antcall target="sdk_java_dist"/>
		<delete dir="${stage.dir}/appcelerator_sdk_java_${VERSION}" failonerror="false"/>
		<unzip src="${stage.dir}/appcelerator_sdk_java_${VERSION}.zip" dest="${stage.dir}"/>
	</target>
	<target name="install_java_examples" depends="force_examples, sdk_java_dist">
		<delete dir="${stage.dir}/appcelerator_sdk_java_${VERSION}" failonerror="false"/>
		<unzip src="${stage.dir}/appcelerator_sdk_java_${VERSION}.zip" dest="${stage.dir}"/>

		<antcall target="install_java_example">
			<param name="example" value="forums"/>
		</antcall>
		<antcall target="install_java_example">
			<param name="example" value="simple"/>
		</antcall>
	</target>
	<target name="install_dotnet" depends="force_examples, sdk_dotnet_dist">
		<delete dir="${stage.dir}/sdkprojects/dotnet" failonerror="false"/>
		<unzip src="${stage.dir}/appcelerator_sdk_dotnet_${VERSION}.zip" dest="${stage.dir}/sdkprojects/dotnet"/>
	</target>
	<target name="install_dotnet_examples" depends="force_examples, sdk_dotnet_dist">
		<antcall target="install_dotnet_example">
			<param name="example" value="simple"/>
		</antcall>
	</target>
	<target name="install_dotnet_example" depends="force_examples, sdk_dotnet_dist">
		<delete dir="${stage.dir}/exampleprojects/${example}_dotnet" failonerror="false"/>
		<unzip src="${stage.dir}/appcelerator_sdk_dotnet_${VERSION}.zip" dest="${stage.dir}/exampleprojects/${example}_dotnet"/>
		<copy todir="${stage.dir}/exampleprojects/${example}_dotnet" overwrite="true">
			<fileset dir="build/examples/${example}/src/dotnet" includes="**"/>
		</copy>
		<copy todir="${stage.dir}/exampleprojects/${example}_dotnet/src/web" overwrite="true">
			<fileset dir="build/examples/${example}/src/web" includes="**"/>
		</copy>
	</target>

	<target name="install_java_example">
		<delete dir="${basedir}/${stage.dir}/exampleprojects/${example}_java" failonerror="false"/>
		<ant dir="${stage.dir}/appcelerator_sdk_java_${VERSION}" target="create.silent">
			<property name="app.name" value="${example}"/>
			<property name="create.dir" value="${basedir}/${stage.dir}/exampleprojects/${example}_java"/>
		</ant>
		<copy todir="${basedir}/${stage.dir}/exampleprojects/${example}_java" overwrite="true">
			<fileset dir="build/examples/${example}" includes="**"/>
		</copy>
		<ant dir="${basedir}/${stage.dir}/exampleprojects/${example}_java" target="dist"/>
		<ant dir="${basedir}/${stage.dir}/exampleprojects/${example}_java" target="undeploy"/>
		<ant dir="${basedir}/${stage.dir}/exampleprojects/${example}_java" target="deploy"/>
	</target>
	<target name="install_ruby" depends="sdk_ruby_dist">
		<delete dir="${stage.dir}/appcelerator_sdk_ruby_${VERSION}" failonerror="false"/>
		<exec dir="${stage.dir}" executable="gem" failonerror="false">
			<arg line="uninstall appcelerator"/>
		</exec>
		<exec dir="${stage.dir}" executable="gem" failonerror="false">
			<arg line="install -l appcelerator-${VERSION}.gem"/>
		</exec>
		<mkdir dir="${stage.dir}/sdkprojects"/>
		<exec dir="${stage.dir}/sdkprojects" executable="appcelerator" failonerror="false">
			<arg line="myrubyapp"/>
		</exec>
	</target>
	<target name="install_ruby_examples" depends="force_examples, sdk_ruby_dist">
		<delete dir="${stage.dir}/appcelerator_sdk_java_${VERSION}" failonerror="false"/>
		<exec dir="${stage.dir}" executable="gem" failonerror="false">
			<arg line="uninstall appcelerator"/>
		</exec>
		<exec dir="${stage.dir}" executable="gem" failonerror="false">
			<arg line="install -l appcelerator-${VERSION}.gem"/>
		</exec>
		<!--
		<antcall target="install_ruby_example">
			<param name="example" value="forums"/>
		</antcall>
		-->
		<antcall target="install_ruby_example">
			<param name="example" value="simple"/>
		</antcall>
	</target>
	<target name="install_ruby_example">
		<delete dir="${basedir}/${stage.dir}/exampleprojects/${example}_ruby" failonerror="false"/>
		<mkdir dir="${basedir}/${stage.dir}/exampleprojects"/>
		<exec dir="${basedir}/${stage.dir}/exampleprojects" executable="appcelerator" failonerror="false">
			<arg line="${example}_ruby"/>
		</exec>
		<copy todir="${basedir}/${stage.dir}/exampleprojects/${example}_ruby/app">
			<fileset dir="build/examples/${example}/src/ruby" includes="**/**"/>
		</copy>
		<copy todir="${basedir}/${stage.dir}/exampleprojects/${example}_ruby/public" overwrite="true">
			<fileset dir="build/examples/${example}/src/web" includes="**/**"/>
		</copy>
	</target>
    <target name="sdk_python_dist" depends="min,build_core_javascript" description="* Builds the Python SDK distribution">
        <mkdir dir="${stage.dir}/python"/>
        <property name="python.public.dir" value="appcelerator/templates/hello_project/+package+/public"/>
        <copy todir="${src.python.dir}/${python.public.dir}" filtering="false">
             <fileset dir="${stage.dir}/web" includes="js/appcelerator*.js"/>
             <fileset dir="${stage.dir}/web" includes="modules/**/**"/>
             <fileset dir="${src.web.dir}" includes="css/**,images/**,index.html,servicetester.html"/>
             <fileset dir="${build.python.dir}" includes="appcelerator.xml"/>
        </copy>
        <exec dir="${src.python.dir}" executable="python" failonerror="false">
            <arg line="setup.py bdist_egg"/>
			<env key="APP_VERSION" value="${APP_VERSION}"/>
        </exec>
        <copy todir="${stage.dir}">
            <fileset dir="${src.python.dir}/dist" includes="*.egg"/>
        </copy>
        <!-- The EGG is made, now remove build artifacts -->
<!--
        <delete failonerror="false">
            <fileset dir="${src.python.dir}/${python.public.dir}" includes="**"/>
        </delete>
        <delete dir="${src.python.dir}">
            <fileset dir="dist" includes="**"/>
            <fileset dir="build" includes="**"/>
        </delete>
-->
	</target>
	<target name="remove_python_egg" depends="copy_script_jars">
        <exec executable="sudo" failonerror="false" dir="/Library/Frameworks/Python.framework/Versions/Current/lib/python2.5/site-packages">
            <arg line="chmod -R 777 *"/>
        </exec>
        <exec executable="rm" failonerror="false">
            <arg line="-rf /Library/Frameworks/Python.framework/Versions/Current/lib/python2.5/site-packages/Appcelerator-*.egg"/>
        </exec>
		<script language="ruby">
			config = File.open "/Library/Frameworks/Python.framework/Versions/Current/lib/python2.5/site-packages/easy-install.pth"
			confignew = File.open "/Library/Frameworks/Python.framework/Versions/Current/lib/python2.5/site-packages/easy-install_temp.pth", "w"
			config.each_line do |line|
				if line =~ /.\/Appcelerator-2.0.2-py2.5.egg.*/
					puts "ingoring #{line}".chomp
				else
					confignew.puts "#{line}".chomp
				end
			end
			confignew.close
			File.delete "/Library/Frameworks/Python.framework/Versions/Current/lib/python2.5/site-packages/easy-install.pth"
			File.rename "/Library/Frameworks/Python.framework/Versions/Current/lib/python2.5/site-packages/easy-install_temp.pth", "/Library/Frameworks/Python.framework/Versions/Current/lib/python2.5/site-packages/easy-install.pth"
		</script>
	</target>
    <target name="install_python" depends="sdk_python_dist">
		<antcall target="do.install_python"/>
		<antcall target="do.install_python_createproject">
			<param name="dir" value="${stage.dir}/sdkprojects"/>
			<param name="app" value="mypythonapp"/>
		</antcall>
	</target>
    <target name="do.install_python" depends="">
        <echo>This task assumes python2.5</echo>
		<antcall target="remove_python_egg"/>
        <exec executable="sudo" failonerror="false">
            <arg line="easy_install stage/Appcelerator-${APP_VERSION}-py2.5.egg"/>
        </exec>
        <exec executable="sudo" failonerror="false" dir="/Library/Frameworks/Python.framework/Versions/Current/lib/python2.5/site-packages">
            <arg line="chmod -R 777 *"/>
        </exec>
	</target>
    <target name="do.install_python_createproject" depends="">
		<delete dir="${dir}" failonerror="false"/>
		<mkdir dir="${dir}"/>
		<exec dir="${dir}" executable="paster" failonerror="false">
			<arg line="create -t appcelerator ${app}"/>
		</exec>
	</target>
	<target name="install_python_examples" depends="sdk_python_dist">
		<antcall target="do.install_python"/>
		<antcall target="install_python_example">
			<param name="example" value="simple"/>
		</antcall>
	</target>
	<target name="install_python_example" depends="sdk_python_dist">
		<antcall target="do.install_python_createproject">
			<param name="dir" value="${stage.dir}/exampleprojects"/>
			<param name="app" value="${example}_python"/>
		</antcall>
		<copy todir="${stage.dir}/exampleprojects/${example}_python/${example}_python" overwrite="true">
			<fileset dir="build/examples/${example}/src/python" includes="**"/>
		</copy>
		<copy todir="${stage.dir}/exampleprojects/${example}_python/${example}_python/public" overwrite="true">
			<fileset dir="build/examples/${example}/src/web" includes="**"/>
		</copy>
	</target>

	<target name="install_php" depends="sdk_php_dist">
		<delete dir="${stage.dir}/sdkprojects/myphpapp" failonerror="false"/>
		<unzip src="${stage.dir}/appcelerator_sdk_php_${VERSION}.zip" dest="${stage.dir}/sdkprojects/myphpapp"/>
		<property name="php.project.dir" value="${stage.dir}/sdkprojects/myphpapp"/>
		<antcall target="undeploy_php"/>
		<antcall target="deploy_php"/>
	</target>
	<target name="install_php_examples" depends="force_examples, sdk_php_dist">
		<antcall target="install_php_example">
			<param name="example" value="simple"/>
		</antcall>
	</target>
	<target name="install_php_example">
		<delete dir="${stage.dir}/exampleprojects/${example}_php" failonerror="false"/>
		<unzip src="${stage.dir}/appcelerator_sdk_php_${VERSION}.zip" dest="${stage.dir}/exampleprojects/${example}_php"/>
		<copy todir="${stage.dir}/exampleprojects/${example}_php/appcelerator_sdk_php_${VERSION}/src/php" overwrite="true">
			<fileset dir="build/examples/${example}/src/php" includes="**"/>
		</copy>
		<copy todir="${stage.dir}/exampleprojects/${example}_php/appcelerator_sdk_php_${VERSION}/src/web" overwrite="true">
			<fileset dir="build/examples/${example}/src/web" includes="**"/>
		</copy>
		<antcall target="undeploy_php">
			<param name="php.project.dir" value="${stage.dir}/exampleprojects/${example}_php/appcelerator_sdk_php_${VERSION}"/>
		</antcall>
		<antcall target="deploy_php">
			<param name="php.project.dir" value="${stage.dir}/exampleprojects/${example}_php/appcelerator_sdk_php_${VERSION}"/>
		</antcall>
		<antcall target="deploy_php"/>
	</target>
	<target name="nightly_dist" description="* Builds the nightlighty source distribution">
		<tstamp>
			<format property="TODAY" pattern="MMddyyyy"/>
		</tstamp>
		<echo>Building the Appcelerator Platform SDK source code nightly distribution</echo>
		<mkdir dir="stage"/>
		<zip destfile="${stage.dir}/appcelerator_sdk_source_${TODAY}.zip" comment="Appcelerator Platform SDK sourcecode for ${TODAY}">
			<zipfileset dir="." prefix="appcelerator_sdk_source_${TODAY}">
				<include name="**/*"/>
				<exclude name="stage/**"/>
				<exclude name="output/**"/>
				<exclude name=".server.id"/>
			</zipfileset>
		</zip>
	</target>
    <target name="build_src_dist" description="* Builds the source distribution" depends="init">
        <echo>Building the Appcelerator Platform SDK source code distribution</echo>
        <mkdir dir="stage"/>
        <zip destfile="${stage.dir}/appcelerator_sdk_source_${VERSION}.zip" comment="Appcelerator Platform SDK sourcecode for ${VERSION}">
            <zipfileset dir="." prefix="appcelerator_sdk_source_${VERSION}">
                <include name="**/*"/>
                <exclude name="stage/**"/>
                <exclude name="output/**"/>
                <exclude name=".server.id"/>
            </zipfileset>
        </zip>
    </target>
	<target name="gendoc_widget">
		<input message="what is the title (ex: Tree View)?" addproperty="title"/>
		<input message="what is the name (ex: treeview)?" addproperty="name"/>
		<copy file="${src.doc.dir}/gendoc-templates/widget.html" tofile="${src.doc.dir}/${name}.html" overwrite="true">
			<filterchain>
			    <replacetokens>
			      <token key="widget.title" value="${title}"/>
			      <token key="widget.name" value="${name}"/>
			    </replacetokens>
			  </filterchain>
		</copy>
	</target>
	<target name="promptnametitle">
		<input message="what is the title (ex: .NET)?" addproperty="title"/>
		<input message="what is the name (ex: dotnet)?" addproperty="name"/>
	</target>
	<target name="gendoc_gettingstarted" depends="promptnametitle">
		<copy file="${src.doc.dir}/gendoc-templates/gettingstarted.html" tofile="${src.doc.dir}/${name}gettingstarted.html" overwrite="true">
			<filterchain>
			    <replacetokens>
			      <token key="title" value="${title}"/>
			      <token key="name" value="${name}gettingstarted"/>
			    </replacetokens>
			  </filterchain>
		</copy>
	</target>
	<target name="build_spring_jar" depends="java_compile">
		<mkdir dir="${stage.dir}/appcelerator-spring"/>
		<mkdir dir="${stage.dir}/appcelerator-spring/META-INF"/>
		<copy todir="${stage.dir}/appcelerator-spring/META-INF">
			<fileset dir="src/java/org/appcelerator/spring/handler" includes="spring.handlers,spring.schemas"/>
		</copy>
		<jar destfile="${stage.dir}/appcelerator-spring.jar">
			<fileset dir="${stage.dir}/appcelerator-spring"/>
			<fileset dir="${stage.dir}/java" includes="classes/**"/>
		</jar>
	</target>
	<target name="undeploy_doc">
		<available file="${deploy.dir}/doc" type="dir" property="doc.deploy.dir.exists"/>
		<available file="${deploy.dir}/doc.war" type="file" property="doc.deploy.war.exists"/>
		<antcall target="undeploy.war.doc"/>
		<antcall target="undeploy.dir.doc"/>
	</target>
	<target name="undeploy.dir.doc" if="doc.deploy.dir.exists">
		<delete dir="${deploy.dir}/doc"/>
	</target>
	<target name="undeploy.war.doc" if="doc.deploy.war.exists">
		<delete file="${deploy.dir}/doc.war"/>
	</target>
	<target name="undeploy_web_unit">
		<available file="${deploy.dir}/unittest" type="dir" property="unittest.deploy.dir.exists"/>
		<available file="${deploy.dir}/unittest.war" type="file" property="unittest.deploy.war.exists"/>
		<antcall target="undeploy.war.unittest"/>
		<antcall target="undeploy.dir.unittest"/>
	</target>
	<target name="undeploy.dir.unittest" if="unittest.deploy.dir.exists">
		<delete dir="${deploy.dir}/unittest"/>
	</target>
	<target name="undeploy.war.unittest" if="unittest.deploy.war.exists">
		<delete file="${deploy.dir}/unittest.war"/>
	</target>

	<target name="deploy_doc" description="* deploys the doc as a war to ${deploy.dir}">
		<available file="${deploy.dir}" type="dir" property="deploy.dir.exists" />
		<fail unless="deploy.dir.exists">Directory ${deploy.dir} doesn't exist.</fail>
		<copy todir="${deploy.dir}">
			<fileset dir="stage" includes="doc.war" />
		</copy>
	</target>
	<target name="deploy_web_unit" description="* deploys the unittest as a war to ${deploy.dir}">
		<available file="${deploy.dir}" type="dir" property="deploy.dir.exists" />
		<fail unless="deploy.dir.exists">Directory ${deploy.dir} doesn't exist.</fail>
		<copy todir="${deploy.dir}">
			<fileset dir="stage" includes="unittest.war" />
		</copy>
	</target>
	<target name="deploy_php" description="deploys php src and web files to ${php.deploy.dir}">
		<property name="php.project.dir" value="stage/sdk/php"/>
		<available file="${php.deploy.dir}" type="dir" property="php.deploy.dir.exists" />
		<fail unless="php.deploy.dir.exists">Directory ${php.deploy.dir} doesn't exist.</fail>
		<echo>using src dir of ${php.project.dir}</echo>
		<copy todir="${php.deploy.dir}">
			<fileset dir="${php.project.dir}/src" includes="**/**,*.*" />
		</copy>
	</target>
	<target name="undeploy_php">
		<available file="${php.deploy.dir}" type="dir" property="php.deploy.dir.exists"/>
		<antcall target="undeploy.dir.php"/>
	</target>
	<target name="undeploy.dir.php" if="php.deploy.dir.exists">
		<delete>
			<fileset dir="${php.deploy.dir}" includes="**/**"/>
		</delete>
	</target>
	<target name="publish_doc" depends="build_doc,undeploy_doc,deploy_doc"/>
	<target name="publish_web_unit" depends="build_web_unit,undeploy_web_unit,deploy_web_unit"/>
	<target name="publish_all" depends="publish_doc,publish_web_unit"/>
	<target name="publish_web_unit_scp" depends="build_web_unit,undeploy_web_unit_ssh,deploy_web_unit_scp"/>
	<target name="publish_doc_scp" depends="build_doc,undeploy_doc_ssh,deploy_doc_scp"/>
	<target name="publish_all_scp" depends="publish_doc_scp,publish_web_unit_scp"/>
	
	<target name="publish_dist" depends="sdk_all_dist,build_src_dist" description="* Deploy distributions to distribution server">
        <fail message="must define scp.dist.dir" unless="scp.dist.dir"/>
        <fail message="must define scp.dist.host" unless="scp.dist.host"/>
        <fail message="must define scp.dist.user" unless="scp.dist.user"/>
        <fail message="must define scp.dist.pwd" unless="scp.dist.pwd"/>
		
        <scp todir="${scp.dist.user}@${scp.dist.host}:/tmp" trust="true" password="${scp.dist.pwd}" verbose="true">
            <fileset dir="${stage.dir}" includes="appcelerator_sdk_source_${VERSION}.zip"/>
        </scp>
        <scp todir="${scp.dist.user}@${scp.dist.host}:/tmp" trust="true" password="${scp.dist.pwd}" verbose="true">
            <fileset dir="${stage.dir}" includes="appcelerator_sdk_java_${VERSION}.zip"/>
        </scp>
        <scp todir="${scp.dist.user}@${scp.dist.host}:/tmp" trust="true" password="${scp.dist.pwd}" verbose="true">
            <fileset dir="${stage.dir}" includes="appcelerator_sdk_php_${VERSION}.zip"/>
        </scp>
        <scp todir="${scp.dist.user}@${scp.dist.host}:/tmp" trust="true" password="${scp.dist.pwd}" verbose="true">
            <fileset dir="${stage.dir}" includes="appcelerator-${VERSION}.gem"/>
        </scp>
		
        <!--
        <scp todir="${scp.dist.user}@${scp.dist.host}:/tmp" trust="true" password="${scp.dist.pwd}" verbose="true">
            <fileset dir="${stage.dir}" includes="appcelerator_sdk_dotnet_${VERSION}.zip"/>
        </scp> 
        -->

		<sshexec host="${scp.dist.host}" username="${scp.dist.user}" password="${scp.dist.pwd}" trust="true"
            command="echo ${scp.dist.pwd} | sudo -S mkdir -p ${scp.dist.dir}/sdk_java/${VERSION} &amp;&amp; echo ${scp.dist.pwd} | sudo -S mv /tmp/appcelerator_sdk_java_${VERSION}.zip ${scp.dist.dir}/sdk_java/${VERSION}"/>
		
        <sshexec host="${scp.dist.host}" username="${scp.dist.user}" password="${scp.dist.pwd}" trust="true"
            command="echo ${scp.dist.pwd} | sudo -S mkdir -p ${scp.dist.dir}/sdk_php/${VERSION} &amp;&amp; echo ${scp.dist.pwd} | sudo -S mv /tmp/appcelerator_sdk_php_${VERSION}.zip ${scp.dist.dir}/sdk_php/${VERSION}"/>

        <sshexec host="${scp.dist.host}" username="${scp.dist.user}" password="${scp.dist.pwd}" trust="true"
            command="echo ${scp.dist.pwd} | sudo -S mkdir -p ${scp.dist.dir}/sdk_ruby/${VERSION} &amp;&amp; echo ${scp.dist.pwd} | sudo -S mv /tmp/appcelerator-${VERSION}.gem ${scp.dist.dir}/sdk_ruby/${VERSION}"/>

        <sshexec host="${scp.dist.host}" username="${scp.dist.user}" password="${scp.dist.pwd}" trust="true"
            command="echo ${scp.dist.pwd} | sudo -S mkdir -p ${scp.dist.dir}/sdk_src/${VERSION} &amp;&amp; echo ${scp.dist.pwd} | sudo -S mv /tmp/appcelerator_sdk_source_${VERSION}.zip ${scp.dist.dir}/sdk_src/${VERSION}" />
		
        <!--
        <sshexec host="${scp.dist.host}" username="${scp.dist.user}" password="${scp.dist.pwd}" trust="true"
            command="echo ${scp.dist.pwd} | sudo -S mkdir -p ${scp.dist.dir}/sdk_dotnet/${VERSION} &amp;&amp; echo ${scp.dist.pwd} | sudo -S mv /tmp/appcelerator_sdk_dotnet_${VERSION}.zip ${scp.dist.dir}/sdk_dotnet/${VERSION}"/>
        --> 
        
	</target>
	
	<target name="deploy_doc_scp">
		<antcall target="-deploy_scp">
			<param name="dir" value="stage"/>
			<param name="file" value="doc.war"/>
		</antcall>
	</target>
	<target name="deploy_web_unit_scp">
		<antcall target="-deploy_scp">
			<param name="dir" value="stage"/>
			<param name="file" value="unittest.war"/>
		</antcall>
	</target>
	<target name="undeploy_doc_ssh">
		<antcall target="-undeploy_ssh">
			<param name="file" value="doc.war"/>
			<param name="dir" value="doc"/>
		</antcall>
	</target>
	<target name="undeploy_web_unit_ssh">
		<antcall target="-undeploy_ssh">
			<param name="file" value="unittest.war"/>
			<param name="dir" value="unittest"/>
		</antcall>
	</target>
	<target name="-undeploy_ssh" depends="get_jsch">
		<fail message="must define scp.dir" unless="scp.dir"/>
		<fail message="must define scp.host" unless="scp.host"/>
		<fail message="must define scp.user" unless="scp.user"/>
		<fail message="must define scp.pwd" unless="scp.pwd"/>
		<sshexec host="${scp.host}" username="${scp.user}" password="${scp.pwd}" trust="true"
			command="echo ${scp.pwd} | sudo -S rm -rf ${scp.dir}/${dir}/*;rm -rf ${scp.dir}/${file}"/>
	</target>
	<target name="get_jsch">
		<available file="${ant.home}/lib/jsch-0.1.35.jar" type="file" property="jsch.exists" />
		<antcall target="-get_jsch"/>
	</target>
	<target name="-get_jsch" unless="jsch.exists">
		<get src="http://superb-east.dl.sourceforge.net/sourceforge/jsch/jsch-0.1.35.jar" dest="${ant.home}/lib/jsch-0.1.35.jar"/>
	</target>
	<target name="echoproperties">
		<echoproperties/>
	</target>
	<target name="-deploy_scp" depends="get_jsch">
		<fail message="must define scp.dir" unless="scp.dir"/>
		<fail message="must define scp.host" unless="scp.host"/>
		<fail message="must define scp.user" unless="scp.user"/>
		<fail message="must define scp.pwd" unless="scp.pwd"/>
        <scp todir="${scp.user}@${scp.host}:/tmp" trust="true" password="${scp.pwd}" verbose="true">
            <fileset dir="${dir}" includes="${file}"/>
        </scp>
        <sshexec host="${scp.host}" username="${scp.user}" password="${scp.pwd}" trust="true"
            command="echo ${scp.pwd} | sudo -S mv /tmp/${file} ${scp.dir}"/>
	</target>
	<target name="copy_script_jars" description="** copies the required script jars to ${ant.home}/lib">
		<copy todir="${ant.home}/lib">
			<fileset dir="build/java/antlib" includes="jruby.jar,asm-2.2.3.jar,asm-commons-2.2.3.jar,bsf.jar,backport-util-concurrent.jar"/>
			<fileset dir="build/java/lib" includes="commons-logging-1.0.4.jar"/>
		</copy>
	</target>
	<target name="remove_script_jars">
		<delete>
			<fileset dir="${ant.home}/lib" 
				includes="jruby.jar,asm-2.2.3.jar,asm-commons-2.2.3.jar,bsf.jar,backport-util-concurrent.jar,jline.jar,commons-logging-1.0.4.jar"/>
		</delete>
	</target>
</project>
